---
phase: 07-dashboard-surface
plan: 01
type: execute
depends_on: []
files_modified: [src/surfaces/dashboard/DashboardSurface.tsx, src/surfaces/dashboard/index.ts, src/surfaces/index.ts, src/main.tsx]
---

<objective>
Create DashboardSurface container component with state management and data loading.

Purpose: Establish the dashboard surface structure following patterns from AuthSurface.
Output: DashboardSurface container that loads templates, exercises, and charts on mount.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase patterns:
@.planning/phases/06-auth-surface/06-01-SUMMARY.md

# Source patterns to follow:
@src/surfaces/auth/AuthSurface.tsx

# Services to use:
@src/services/index.ts

# Existing app.js dashboard state (lines 25-30, 341-391):
# - templates, userCharts, chartInstances, chartsNeedRefresh, availableExercises
# - loadDashboard(), loadTemplates(), loadExercises(), loadUserCharts()
# - renderAllCharts(), destroyAllCharts()
@js/app.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DashboardSurface container with state and structure</name>
  <files>src/surfaces/dashboard/DashboardSurface.tsx, src/surfaces/dashboard/index.ts</files>
  <action>
Create DashboardSurface.tsx following AuthSurface.tsx patterns:

**State variables (from js/app.js lines 25-30):**
- templates: Template[] - fetched from templates service
- userCharts: UserChart[] - fetched from charts service
- availableExercises: Exercise[] - fetched from exercises service
- chartsNeedRefresh: boolean - controls chart reload
- isLoading: boolean - loading state for initial fetch
- error: string - error messages
- successMessage: string - success messages

**Import types from @/types:**
- Template, Exercise, UserChart (check existing types)

**Structure:**
- Function component with useState hooks for all state
- useEffect for initial data loading on mount
- Placeholder render structure with sections for:
  - Header with logout button
  - Template list section (placeholder for now)
  - Charts section (placeholder for now)

**Pattern notes:**
- Follow AuthSurface controlled component patterns
- Use JSDoc comments for component documentation
- Create index.ts barrel export

Do NOT implement data loading functions yet - just set up the state structure.
  </action>
  <verify>npx tsc --noEmit passes, file exists with proper state declarations</verify>
  <done>DashboardSurface.tsx exists with all state variables, barrel export created</done>
</task>

<task type="auto">
  <name>Task 2: Implement data loading and integrate into main.tsx</name>
  <files>src/surfaces/dashboard/DashboardSurface.tsx, src/surfaces/index.ts, src/main.tsx</files>
  <action>
**Add data loading functions (matching js/app.js lines 341-391):**

1. **loadDashboard():**
   - Async function that calls loadTemplates and loadExercises in parallel using Promise.all
   - Sets isLoading true at start, false at end
   - Catches errors and sets error state
   - Matches js/app.js lines 343-359

2. **loadTemplates():**
   - Call window.templates.getTemplates() (backward compat) OR import templates service
   - Set templates state with result
   - Matches js/app.js lines 361-369

3. **loadExercises():**
   - Call window.exercises.getExercises()
   - Set availableExercises state with result
   - Matches js/app.js lines 371-379

4. **useEffect for initial load:**
   - Call loadDashboard() on component mount
   - Empty dependency array []

**Update surfaces/index.ts:**
- Add DashboardSurface to barrel export

**Update main.tsx:**
- Import DashboardSurface
- Create simple App component that manages currentSurface state
- Render AuthSurface when currentSurface === 'auth'
- Render DashboardSurface when currentSurface === 'dashboard'
- For now, hardcode to 'dashboard' to test (will add auth state later)

**Pattern notes:**
- Use window.* for service calls (backward compat with js/)
- ServiceResult pattern: check for error in result, throw if present
  </action>
  <verify>npm run build succeeds, DashboardSurface loads and calls services on mount</verify>
  <done>Data loading works, main.tsx renders DashboardSurface, build passes</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] DashboardSurface.tsx exists with all state variables
- [ ] Data loading functions implemented (loadDashboard, loadTemplates, loadExercises)
- [ ] useEffect calls loadDashboard on mount
- [ ] main.tsx updated to render DashboardSurface
- [ ] Barrel exports updated in surfaces/index.ts
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- DashboardSurface container ready for child components
</success_criteria>

<output>
After completion, create `.planning/phases/07-dashboard-surface/07-01-SUMMARY.md`
</output>
