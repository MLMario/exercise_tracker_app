---
phase: 20-exercise-delete
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/surfaces/dashboard/MyExercisesList.tsx
  - apps/web/src/surfaces/dashboard/SettingsPanel.tsx
  - apps/web/src/surfaces/dashboard/DashboardSurface.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Deleting an exercise immediately removes its charts from the dashboard without requiring a page refresh"
    - "Delete confirmation modal buttons are fully visible and properly sized within the modal"
  artifacts:
    - path: "apps/web/src/surfaces/dashboard/MyExercisesList.tsx"
      provides: "onExerciseDeleted callback invocation after successful delete, btn-sm on modal buttons"
    - path: "apps/web/src/surfaces/dashboard/SettingsPanel.tsx"
      provides: "onExerciseDeleted prop threading from DashboardSurface to MyExercisesList"
    - path: "apps/web/src/surfaces/dashboard/DashboardSurface.tsx"
      provides: "onExerciseDeleted handler that calls loadUserCharts()"
  key_links:
    - from: "MyExercisesList.tsx"
      to: "DashboardSurface.tsx"
      via: "onExerciseDeleted callback prop threaded through SettingsPanel"
      pattern: "onExerciseDeleted"
---

<objective>
Close two UAT gaps from Phase 20: (1) charts not disappearing immediately when an exercise is deleted, and (2) modal buttons overflowing the modal container.

Purpose: Exercise deletion should feel instant and complete -- charts tied to the deleted exercise must vanish from the dashboard without a manual refresh. Modal buttons must fit cleanly within the confirmation dialog.

Output: Updated MyExercisesList, SettingsPanel, and DashboardSurface with callback wiring and button sizing fix.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-exercise-delete/20-01-SUMMARY.md
@.planning/phases/20-exercise-delete/20-UAT.md
@apps/web/src/surfaces/dashboard/MyExercisesList.tsx
@apps/web/src/surfaces/dashboard/SettingsPanel.tsx
@apps/web/src/surfaces/dashboard/DashboardSurface.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Thread onExerciseDeleted callback and refresh charts on delete</name>
  <files>
    apps/web/src/surfaces/dashboard/DashboardSurface.tsx
    apps/web/src/surfaces/dashboard/SettingsPanel.tsx
    apps/web/src/surfaces/dashboard/MyExercisesList.tsx
  </files>
  <action>
    Wire an onExerciseDeleted callback from DashboardSurface through SettingsPanel to MyExercisesList so that deleting an exercise triggers a chart refresh.

    1. **MyExercisesList.tsx** -- Accept an optional `onExerciseDeleted?: () => void` prop:
       - Change the component signature from `export function MyExercisesList()` to `export function MyExercisesList({ onExerciseDeleted }: { onExerciseDeleted?: () => void })`.
       - In the `confirmDelete` callback (lines 151-164), after the successful delete block (after `setHasTemplateDeps(false)` on line 162), call `onExerciseDeleted?.()`.

    2. **SettingsPanel.tsx** -- Thread the callback:
       - Add `onExerciseDeleted?: () => void` to the `SettingsPanelProps` interface.
       - Destructure it in the component: `{ isOpen, onClose, onLogout, onExerciseDeleted }`.
       - Pass it to MyExercisesList: change `<MyExercisesList />` (line 79) to `<MyExercisesList onExerciseDeleted={onExerciseDeleted} />`.

    3. **DashboardSurface.tsx** -- Create handler and pass it:
       - Create a `handleExerciseDeleted` callback that calls `loadUserCharts()` to refresh chart state. Use useCallback with empty deps (loadUserCharts is defined in component scope). The function body: `const handleExerciseDeleted = useCallback(async () => { await loadUserCharts(); }, []);`
       - Pass it to SettingsPanel: change `<SettingsPanel isOpen={settingsOpen} onClose={() => setSettingsOpen(false)} onLogout={onLogout} />` to include `onExerciseDeleted={handleExerciseDeleted}`.
  </action>
  <verify>
    Run `npx tsc --noEmit` from apps/web to confirm no type errors. Visually confirm the prop chain: DashboardSurface passes handleExerciseDeleted to SettingsPanel, SettingsPanel passes it to MyExercisesList, MyExercisesList calls it after successful delete.
  </verify>
  <done>Deleting an exercise from My Exercises triggers loadUserCharts() in DashboardSurface, causing charts for the deleted exercise to disappear immediately without page refresh.</done>
</task>

<task type="auto">
  <name>Task 2: Fix modal button sizing with btn-sm class</name>
  <files>
    apps/web/src/surfaces/dashboard/MyExercisesList.tsx
  </files>
  <action>
    Add `btn-sm` class to all four modal buttons (two instances of the delete confirmation modal exist in the file -- one inside the empty state block and one after the exercise list).

    1. **Empty state modal buttons (around lines 207-211):**
       - Change `class="btn btn-secondary"` to `class="btn btn-sm btn-secondary"` on the "Keep Exercise" button.
       - Change `class="btn btn-danger"` to `class="btn btn-sm btn-danger"` on the "Delete Exercise" button.

    2. **Main list modal buttons (around lines 321-325):**
       - Change `class="btn btn-secondary"` to `class="btn btn-sm btn-secondary"` on the "Keep Exercise" button.
       - Change `class="btn btn-danger"` to `class="btn btn-sm btn-danger"` on the "Delete Exercise" button.

    The existing `.btn-sm` class in styles.css (line 499) provides `padding: 0.5rem var(--spacing-md)`, `font-size: 0.875rem`, and `min-height: 36px` (down from 44px), which will prevent the buttons from overflowing the 336px-wide `modal-sm` container.
  </action>
  <verify>
    Search MyExercisesList.tsx for `btn-sm` -- should find exactly 4 occurrences (2 buttons x 2 modal instances). Visually confirm no `btn btn-secondary` or `btn btn-danger` class strings remain without `btn-sm` inside modal-footer divs.
  </verify>
  <done>All four delete confirmation modal buttons use btn-sm class and fit fully within the modal-sm container without overflow.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors from apps/web
2. Grep for `onExerciseDeleted` shows the prop defined in MyExercisesList, threaded through SettingsPanel, and passed from DashboardSurface
3. Grep for `btn-sm` in MyExercisesList.tsx returns 4 matches
4. The confirmDelete function in MyExercisesList calls onExerciseDeleted after successful deletion
</verification>

<success_criteria>
- Charts disappear immediately when an exercise is deleted (no refresh needed)
- Modal buttons are properly sized and fully visible within the confirmation dialog
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/20-exercise-delete/20-02-SUMMARY.md`
</output>
