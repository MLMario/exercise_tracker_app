---
phase: 09-exercise-library-surface
plan: 01
type: execute
depends_on: []
files_modified: [src/surfaces/exercise-library/ExerciseLibrarySurface.tsx, src/surfaces/exercise-library/ExerciseCard.tsx, src/surfaces/exercise-library/CategoryFilter.tsx, src/surfaces/exercise-library/index.ts]
domain: preact
---

<objective>
Create ExerciseLibrarySurface container with category filtering and exercise display.

Purpose: Provide a dedicated full-page surface for browsing and filtering exercises, separate from the modal picker. This exposes exercise management functionality that exists in the service but wasn't accessible in the original modal-only approach.

Output: ExerciseLibrarySurface component with category tabs, search, and exercise grid display.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/08-template-editor-surface/08-03-SUMMARY.md

# Existing patterns to follow:
@src/surfaces/dashboard/DashboardSurface.tsx
@src/components/ExercisePickerModal.tsx
@src/services/exercises.ts
@src/types/database.ts

**Tech stack available:** Preact, TypeScript, exercises service
**Established patterns:** Surface containers with useState/useEffect, service calls with ServiceResult pattern, category filtering
**Constraining decisions:**
- Preact selected for all surfaces (Phase 3)
- ServiceResult<T> pattern for error handling (Phase 5)
- Shared components in src/components/ (Phase 8)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExerciseLibrarySurface container with category filtering</name>
  <files>src/surfaces/exercise-library/ExerciseLibrarySurface.tsx, src/surfaces/exercise-library/CategoryFilter.tsx, src/surfaces/exercise-library/index.ts</files>
  <action>
Create the ExerciseLibrarySurface following DashboardSurface patterns:

1. Create `src/surfaces/exercise-library/` directory

2. Create `CategoryFilter.tsx`:
   - Props: categories (string[]), selectedCategory (string | null), onSelect (category) => void
   - Render horizontal tabs/buttons for each category plus "All" option
   - Apply .active class to selected category
   - Use existing CSS classes from styles.css where possible

3. Create `ExerciseLibrarySurface.tsx`:
   - Import useState, useEffect from preact/hooks
   - Import Exercise type from @/types

   State:
   - exercises: Exercise[] - all loaded exercises
   - filteredExercises: Exercise[] - filtered by category/search
   - selectedCategory: string | null - current filter (null = all)
   - searchQuery: string - search input value
   - isLoading: boolean
   - error: string

   Props:
   - onBack?: () => void - navigation callback to return to dashboard

   Effects:
   - useEffect to load exercises on mount via window.exercises.getExercises()
   - useMemo or useEffect to filter exercises when category/search changes

   Filtering logic (from ExercisePickerModal pattern):
   - If no category selected and no search: show all
   - If category selected: filter by ex.category === selectedCategory
   - If search: filter by ex.name.toLowerCase().includes(query) || ex.category.toLowerCase().includes(query)
   - Combine both filters if both active

   Render structure:
   - Header with title "Exercise Library" and back button (if onBack provided)
   - Error message display (clickable to dismiss)
   - Search input (class="input", placeholder="Search exercises...")
   - CategoryFilter component
   - Exercise grid container (will render ExerciseCard in Task 2)
   - Empty state when filteredExercises.length === 0
   - Loading indicator when isLoading

4. Create `index.ts` barrel export:
   - export { ExerciseLibrarySurface } from './ExerciseLibrarySurface'
   - export { CategoryFilter } from './CategoryFilter'
  </action>
  <verify>npx tsc --noEmit passes, files exist in src/surfaces/exercise-library/</verify>
  <done>ExerciseLibrarySurface loads exercises, filters by category/search, displays loading/error states</done>
</task>

<task type="auto">
  <name>Task 2: Create ExerciseCard component and integrate with surface</name>
  <files>src/surfaces/exercise-library/ExerciseCard.tsx, src/surfaces/exercise-library/ExerciseLibrarySurface.tsx, src/surfaces/exercise-library/index.ts</files>
  <action>
Create ExerciseCard for displaying individual exercises:

1. Create `ExerciseCard.tsx`:
   - Props interface ExerciseCardProps:
     - exercise: Exercise
     - onDelete?: (id: string) => void (optional, for delete button)
     - isCustom: boolean (user_id !== null means custom)

   Render structure (following TemplateCard pattern):
   - Card container div with class="exercise-card"
   - Exercise name (h3 or span with class="exercise-name")
   - Category badge (span with class="badge")
   - Equipment info if present (span with class="exercise-equipment")
   - Delete button (only if isCustom && onDelete provided):
     - Button with class="btn btn-icon btn-danger-subtle"
     - Title="Delete exercise"
     - onClick calls onDelete(exercise.id)

2. Update `ExerciseLibrarySurface.tsx`:
   - Import ExerciseCard
   - In the exercise grid container, map filteredExercises to ExerciseCard components:
     ```tsx
     <div class="exercise-grid">
       {filteredExercises.map(exercise => (
         <ExerciseCard
           key={exercise.id}
           exercise={exercise}
           isCustom={exercise.user_id !== null}
         />
       ))}
     </div>
     ```
   - Keep onDelete wiring for Task 2 of Plan 02

3. Update `index.ts`:
   - Add: export { ExerciseCard } from './ExerciseCard'
  </action>
  <verify>npm run build succeeds, ExerciseCard renders for each exercise with name/category/equipment</verify>
  <done>Exercise grid displays all exercises with cards showing name, category, equipment badge, custom indicator</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] ExerciseLibrarySurface.tsx exists with state management
- [ ] CategoryFilter.tsx exists with category tabs
- [ ] ExerciseCard.tsx exists with exercise display
- [ ] index.ts exports all components
- [ ] Filtering logic handles category + search combination
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- ExerciseLibrarySurface displays exercises in grid
- Category filter shows all categories with "All" option
- Search input filters exercises by name/category
- Empty state shown when no exercises match filter
</success_criteria>

<output>
After completion, create `.planning/phases/09-exercise-library-surface/09-01-SUMMARY.md`
</output>
