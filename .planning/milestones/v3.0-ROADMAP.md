# Milestone v3.0: Settings & Exercise Management

**Status:** SHIPPED 2026-02-04
**Phases:** 16-21
**Total Plans:** 9

## Overview

Add a Settings surface with exercise CRUD management, enabling users to manage custom exercises outside the template editor workflow.

## Phases

### Phase 16: Service Layer

**Goal**: Backend infrastructure exists for updating exercises
**Depends on**: Nothing (first phase of milestone)
**Requirements**: BACK-01, BACK-02
**Plans**: 1 plan

Plans:
- [x] 16-01: Add service types and implement updateExercise, getUserExercises, getExerciseDependencies

**Details:**
- Added UpdateExerciseParams, UpdateExerciseError, UpdateExerciseResult, and ExerciseDependencies types
- Extended ExercisesService interface with three new method signatures
- Implemented updateExercise with partial update support, name trimming, character validation, case-insensitive user-scoped uniqueness check
- Typed validation errors (DUPLICATE_NAME, INVALID_NAME, EMPTY_NAME)
- Implemented getUserExercises returning only user-created exercises sorted alphabetically
- Implemented getExerciseDependencies with parallel count queries

### Phase 17: Settings Surface Shell

**Goal**: Users can navigate to a Settings surface and back, with logout relocated from dashboard
**Depends on**: Phase 16
**Requirements**: SETT-01, SETT-02, SETT-03, SETT-04, SETT-05
**Plans**: 1 plan

Plans:
- [x] 17-01: Create settings panel shell with gear icon, slide-in panel, menu, and sub-navigation

**Details:**
- Gear icon replaces logout button in dashboard header
- Settings panel slides in from right with darkened backdrop overlay
- Settings menu shows My Exercises card item and Log Out button
- Internal panel navigation via panelView state ('menu' | 'exercises')
- Panel resets to menu view when closed and reopened

### Phase 18: Exercise List

**Goal**: Users can view their custom exercises in a dedicated management view
**Depends on**: Phase 17
**Requirements**: LIST-01, LIST-04, LIST-05
**Plans**: 1 plan

Plans:
- [x] 18-01: Create MyExercisesList component with data fetching, list rendering, empty state, and SettingsPanel integration

**Details:**
- MyExercisesList component with useState-based data fetching on mount
- Calls getUserExercises() which filters is_system=false and sorts A-Z
- Three render states: loading, error, empty (with create button placeholder)
- List renders rows with exercise name and category

### Phase 19: Exercise Edit

**Goal**: Users can edit the name and category of their custom exercises inline
**Depends on**: Phase 18
**Requirements**: CRUD-02, CRUD-03, CRUD-04, CRUD-05, CRUD-06
**Plans**: 1 plan

Plans:
- [x] 19-01: Add accordion edit form with pencil trigger, name/category fields, save/cancel, validation errors, success flash

**Details:**
- Pencil icon on each exercise row expands inline edit form with smooth accordion animation
- Name text input and category native select pre-filled with current values
- Save button disabled until name or category differs from original (dirty check)
- Typed validation errors mapped to inline field errors
- Success flash (green highlight) with 800ms auto-collapse after save
- List re-sorted alphabetically after name/category edits

### Phase 20: Exercise Delete

**Goal**: Users can delete custom exercises with clear warnings about downstream effects
**Depends on**: Phase 19
**Requirements**: CRUD-07, CRUD-08, CRUD-09, CRUD-10
**Plans**: 3 plans

Plans:
- [x] 20-01: Add cascade delete migration, trash icon button, confirmation modal with dependency warning
- [x] 20-02: Gap closure: chart refresh on exercise delete, modal button sizing fix
- [x] 20-03: Gap closure: refresh templates on exercise delete, filter deleted exercises from template data

**Details:**
- ON DELETE CASCADE migration for three FK constraints (template_exercises, workout_log_exercises, user_charts)
- Trash icon button (danger red) on each exercise row
- Confirmation modal with "Delete Exercise?" title and history deletion warning
- Amber template dependency warning when exercise is used
- isDeleting state prevents double-click during async delete
- Chart and template data refresh after delete

### Phase 21: Exercise Create

**Goal**: Users can create new custom exercises from the My Exercises management view
**Depends on**: Phase 18
**Requirements**: CRUD-01
**Plans**: 2 plans

Plans:
- [x] 21-01: Add "+ Create" header button, simplified create modal with name/category fields, empty state wiring
- [x] 21-02: Gap closure: case-insensitive duplicate detection, modal dismiss guard during save

**Details:**
- "+ Create" button in SettingsPanel header (visible only on exercises view)
- Create modal with name input, category dropdown, and sorted list insertion
- Modal opens from both header button and empty state CTA
- Case-insensitive duplicate name detection
- Modal cannot be dismissed during active save operation

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**
- Dedicated UpdateExerciseResult type instead of extending ServiceResult
- Case-insensitive uniqueness via .ilike() without wildcards
- Settings panel as DashboardSurface child overlay, not new AppSurface route
- Slide-from-right panel with CSS transform translateX
- Manual isSaving state for typed validation error handling
- ON DELETE CASCADE on all three FK constraints
- Lifted modal state to SettingsPanel for Create button coordination

**Issues Resolved:**
- Chart not refreshing after exercise delete (20-02)
- Modal button sizing inconsistent (20-02)
- Templates showing stale data after exercise delete (20-03)
- Case-sensitive duplicate detection allowing near-duplicates (21-02)
- Modal dismissible during active save operation (21-02)

**Issues Deferred:** None

**Technical Debt Incurred:** None

---

_For current project status, see .planning/ROADMAP.md_
