# Milestone v2.1: Monorepo Architecture + Root Cleanup

**Status:** âœ… SHIPPED 2026-01-16
**Phases:** 24-30
**Total Plans:** 7

## Overview

Restructured the codebase into a pnpm monorepo with shared packages, enabling code reuse between web and future iOS app. Includes workspace setup, shared package extraction, web app migration, import updates, config fixes, iOS scaffold, and root directory cleanup.

## Phases

### Phase 24: Workspace Setup

**Goal**: Create root `package.json` + `pnpm-workspace.yaml`
**Depends on**: Previous milestone complete
**Plans**: 1 plan

Plans:
- [x] 24-01: Convert npm to pnpm, create workspace configuration

**Details:**
- Replaced npm with pnpm as package manager
- Generated pnpm-lock.yaml (49KB), deleted package-lock.json
- Created pnpm-workspace.yaml with packages/* and apps/* globs
- Updated root package.json: renamed to "ironlift", added "private": true
- Created empty packages/ and apps/ directories with .gitkeep placeholders

### Phase 25: Extract Shared Package

**Goal**: Move `types/`, `services/`, `lib/` to `packages/shared/` with proper exports
**Depends on**: Phase 24
**Plans**: 1 plan

Plans:
- [x] 25-01: Extract types, services, lib to @ironlift/shared package

**Details:**
- Created @ironlift/shared package structure with proper package.json and tsconfig
- Moved types/, services/, lib/ from src/ to packages/shared/src/ preserving git history
- Created barrel export (index.ts) for clean import surface
- Fixed internal imports to use relative paths (blocking fix for package validation)

### Phase 26: Web App Migration

**Goal**: Move `components/`, `surfaces/`, `main.tsx`, `css/`, `assets/`, configs to `apps/web/`
**Depends on**: Phase 25
**Plans**: 1 plan

Plans:
- [x] 26-01: Move web app files to apps/web/, update root configs

**Details:**
- Created apps/web/ package with @ironlift/shared workspace dependency
- Moved all web-specific files (components, surfaces, main.tsx, css, assets, configs) preserving git history
- Updated root package.json with workspace scripts (pnpm --filter pattern)
- Added TypeScript project references for monorepo build orchestration

### Phase 27: Update Imports

**Goal**: Refactor all imports from `@/` to `@ironlift/shared`
**Depends on**: Phase 26
**Plans**: 1 plan

Plans:
- [x] 27-01: Update imports from @/ to @ironlift/shared

**Details:**
- Updated all 11 web app files to use @ironlift/shared for types and services
- Preserved @/components and @/surfaces imports (local to web app)
- Added chart.js to shared package peerDependencies for build resolution
- Added vite optimizeDeps.include for chart.js workspace resolution

### Phase 28: Config Updates

**Goal**: Update `vite.config.ts`, `tsconfig.json`, `vercel.json` for monorepo paths
**Depends on**: Phase 27
**Plans**: 1 plan

Plans:
- [x] 28-01: TypeScript composite projects, ambient env types, Vercel monorepo config

**Details:**
- Configured TypeScript composite projects for workspace packages
- Created ambient ImportMetaEnv types for shared package (framework-agnostic)
- Updated Vercel config for monorepo deployment to apps/web/dist

### Phase 29: iOS Scaffold

**Goal**: Create empty `apps/ios/` structure with placeholder files for future React Native development
**Depends on**: Phase 28
**Plans**: 1 plan

Plans:
- [x] 29-01: Create iOS app scaffold with package.json, README, src placeholder

**Details:**
- Created apps/ios/ directory structure for future React Native development
- Added @ironlift/ios package to pnpm workspace with shared dependency
- Placeholder files ready for React Native initialization

### Phase 30: Root Folder Cleanup

**Goal**: Evaluate and remove unnecessary folders (js/, dist/) while keeping essential folders (.claude, .planning, sql, docs, node_modules)
**Depends on**: Phase 29
**Plans**: 1 plan

Plans:
- [x] 30-01: Remove legacy js/ and dist/ folders, update .gitignore

**Details:**
- Deleted js/ folder (contained only legacy config.local.js from pre-monorepo era)
- Deleted root dist/ folder (stale build output; web app now builds to apps/web/dist/)
- Updated .gitignore to remove obsolete js/config.local.js entry

---

## Milestone Summary

**Key Decisions:**
- Source-only package (no build step, Vite handles transpilation)
- Workspace scripts use pnpm --filter @ironlift/web pattern
- TypeScript project references for monorepo build orchestration
- Package-level type checking instead of root-level
- Ambient ImportMetaEnv types in shared package instead of vite devDependency
- Workspace dependency via workspace:* protocol for iOS scaffold

**Issues Resolved:**
- Fixed internal imports to use relative paths instead of @/ aliases in shared package
- Fixed chart.js resolution for Vite build (added to peerDependencies + optimizeDeps.include)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
