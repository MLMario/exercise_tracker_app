---
phase: 09-workout-surface
plan: 01
type: execute
depends_on: []
files_modified: [src/surfaces/workout/WorkoutSurface.tsx, src/surfaces/workout/index.ts, src/surfaces/index.ts, src/main.tsx]
---

<objective>
Create WorkoutSurface container component with state management, header, and surface routing.

Purpose: Establish the workout surface container that will hold all workout-related components and state.
Output: WorkoutSurface component with props, state, header bar, and navigation integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior surface patterns:
@.planning/phases/07-dashboard-surface/07-01-SUMMARY.md
@.planning/phases/08-template-editor-surface/08-01-SUMMARY.md

# Existing code to migrate:
@js/app.js (lines 693-730: startWorkoutFromTemplate, lines 907-994: finishWorkout flow, cancelWorkout flow)
@index.html (lines 524-661: workout surface HTML structure)

# Existing surfaces:
@src/surfaces/dashboard/DashboardSurface.tsx
@src/surfaces/template-editor/TemplateEditorSurface.tsx
@src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkoutSurface container with state</name>
  <files>src/surfaces/workout/WorkoutSurface.tsx</files>
  <action>
Create WorkoutSurface.tsx following DashboardSurface.tsx pattern:

**Props interface:**
- `template: TemplateWithExercises` - Template to start workout from
- `onFinish?: () => void` - Callback when workout saved
- `onCancel?: () => void` - Callback when workout cancelled

**State (from js/app.js lines 48-77):**
- `activeWorkout` - Object with template_id, template_name, started_at, exercises[]
- `originalTemplateSnapshot` - Deep copy for change detection
- `timerSeconds`, `timerTotalSeconds`, `timerActive`, `timerPaused` - Timer state
- `activeTimerExerciseIndex` - Which exercise timer is running for
- `showFinishWorkoutModal`, `showCancelWorkoutModal`, `showTemplateUpdateModal` - Modal visibility
- `showExercisePicker` - Exercise picker modal
- `pendingWorkoutData` - Workout data pending template update decision
- `error`, `successMessage` - Messages

**WorkoutExercise interface:**
```typescript
interface WorkoutExercise {
  exercise_id: string;
  name: string;
  category: string;
  order: number;
  rest_seconds: number;
  sets: WorkoutSet[];
}

interface WorkoutSet {
  set_number: number;
  weight: number;
  reps: number;
  is_done: boolean;
}
```

**Initialization (useEffect):**
- Initialize activeWorkout from template prop (map exercises with sets, set is_done: false)
- Store originalTemplateSnapshot for change detection

**Header render:**
- Cancel button (left) - calls handleCancelWorkout
- Template name (center)
- Finish button (right) - calls handleFinishWorkout

**Basic structure:**
- Header bar
- Main content area (placeholder for exercise cards)
- Empty state when no exercises
- Footer with "Add Exercise" button placeholder
  </action>
  <verify>npx tsc --noEmit passes, file structure matches DashboardSurface pattern</verify>
  <done>WorkoutSurface.tsx created with props, state interfaces, initialization, header render</done>
</task>

<task type="auto">
  <name>Task 2: Create barrel exports and surface routing</name>
  <files>src/surfaces/workout/index.ts, src/surfaces/index.ts, src/main.tsx</files>
  <action>
**src/surfaces/workout/index.ts:**
```typescript
export { WorkoutSurface } from './WorkoutSurface';
```

**src/surfaces/index.ts:**
Add export for workout surface:
```typescript
export { WorkoutSurface } from './workout';
```

**src/main.tsx:**
1. Import WorkoutSurface from '@/surfaces'
2. Add 'workout' to AppSurface type
3. Add state for activeWorkoutTemplate: `TemplateWithExercises | null`
4. Add handleStartWorkout handler:
   - Set activeWorkoutTemplate to the template
   - Set currentSurface to 'workout'
5. Add handleWorkoutFinish handler:
   - Clear activeWorkoutTemplate
   - Navigate back to dashboard
6. Add handleWorkoutCancel handler:
   - Clear activeWorkoutTemplate
   - Navigate back to dashboard
7. Pass handleStartWorkout to DashboardSurface as onStartWorkout
8. Render WorkoutSurface when currentSurface === 'workout':
   ```tsx
   if (currentSurface === 'workout' && activeWorkoutTemplate) {
     return (
       <WorkoutSurface
         template={activeWorkoutTemplate}
         onFinish={handleWorkoutFinish}
         onCancel={handleWorkoutCancel}
       />
     );
   }
   ```
  </action>
  <verify>npm run build succeeds, surface routing works when clicking "Start Workout" on dashboard template card</verify>
  <done>Barrel exports created, main.tsx updated with workout surface routing, navigation works</done>
</task>

<task type="auto">
  <name>Task 3: Add format utilities and header styling</name>
  <files>src/surfaces/workout/WorkoutSurface.tsx</files>
  <action>
**Add utility functions (from js/app.js lines 1175-1194):**
```typescript
function formatTime(seconds: number): string {
  if (seconds === undefined || seconds === null || isNaN(seconds)) {
    seconds = 0;
  }
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function formatWorkoutDate(isoString: string | null): string {
  if (!isoString) return '';
  const date = new Date(isoString);
  return date.toLocaleDateString('en-US', {
    weekday: 'short',
    month: 'short',
    day: 'numeric',
    year: 'numeric'
  });
}
```

**Complete header render:**
Match index.html lines 526-533 structure:
- "Cancel" button with btn btn-secondary btn-sm class
- Workout info div with template name and formatted date
- "Finish" button with btn btn-primary btn-sm class

**Placeholder content:**
- Exercises list container (empty for now)
- Empty state message when no exercises
- "Add Exercise" button at bottom (disabled placeholder)
  </action>
  <verify>npm run build succeeds, workout surface renders with header when navigating from template card</verify>
  <done>Format utilities added, header fully renders with cancel/finish buttons, placeholder content shows</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] WorkoutSurface component renders when clicking "Start Workout"
- [ ] Header shows cancel button, template name, date, finish button
- [ ] Navigation back to dashboard works (cancel button triggers callback)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- WorkoutSurface container established with proper state structure
- Surface routing functional between dashboard and workout
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-workout-surface/09-01-SUMMARY.md`
</output>
