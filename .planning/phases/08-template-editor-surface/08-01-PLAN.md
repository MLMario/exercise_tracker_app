---
phase: 08-template-editor-surface
plan: 01
type: execute
depends_on: []
files_modified: [src/surfaces/template-editor/TemplateEditorSurface.tsx, src/surfaces/template-editor/index.ts, src/surfaces/index.ts, src/main.tsx]
---

<objective>
Create TemplateEditorSurface container with editingTemplate state and navigation.

Purpose: Establish the template editor surface container following DashboardSurface patterns.
Output: Working container with state management, header, and basic form structure.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-dashboard-surface/07-01-SUMMARY.md

# Key reference files:
@src/surfaces/dashboard/DashboardSurface.tsx
@index.html (lines 415-521 for template editor HTML)
@js/app.js (lines 30-37 for editingTemplate state, 444-536 for template methods)

**Tech stack available:** Preact, TypeScript, Vite
**Established patterns:** Container surfaces with useState, callback props for navigation
**Constraining decisions:**
- Phase 7: Window globals for service calls (window.templates)
- Phase 6: Presentational components with props, container manages state
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TemplateEditorSurface container with state</name>
  <files>src/surfaces/template-editor/TemplateEditorSurface.tsx, src/surfaces/template-editor/index.ts</files>
  <action>
Create TemplateEditorSurface.tsx following DashboardSurface pattern:

1. Define EditingExercise interface matching js/app.js line 580-590:
   - exercise_id: string
   - name: string
   - category: string
   - default_rest_seconds: number
   - sets: Array<{ set_number: number, weight: number, reps: number }>

2. Define EditingTemplate interface matching js/app.js lines 32-37:
   - id: string | null
   - name: string
   - exercises: EditingExercise[]

3. Props interface:
   - template?: TemplateWithExercises (for edit mode, undefined for create)
   - onSave: () => void (called after successful save)
   - onCancel: () => void (called to navigate back)

4. State variables:
   - editingTemplate: EditingTemplate (initialized from props.template or empty)
   - isSubmitting: boolean
   - error: string
   - successMessage: string

5. Implement methods matching js/app.js:
   - handleSave() - lines 469-509, calls window.templates.createTemplate or updateTemplate
   - handleCancel() - calls props.onCancel

6. Render basic structure:
   - Header with Cancel button (left), title (center), Save button (right)
   - Form with template name input
   - Placeholder div for exercises list (to be built in Plan 02)
   - Error/success message display

Create barrel export index.ts exporting TemplateEditorSurface.
  </action>
  <verify>npx tsc --noEmit passes, file exists with correct structure</verify>
  <done>TemplateEditorSurface.tsx has state, save/cancel handlers, header, and name input</done>
</task>

<task type="auto">
  <name>Task 2: Wire TemplateEditorSurface into surface routing</name>
  <files>src/surfaces/index.ts, src/main.tsx</files>
  <action>
1. Update src/surfaces/index.ts to export TemplateEditorSurface.

2. Update src/main.tsx App component:
   - Import TemplateEditorSurface
   - Add editingTemplate state: TemplateWithExercises | null | 'new'
   - Add surface navigation:
     - handleEditTemplate(template) - sets editingTemplate to template
     - handleCreateNewTemplate() - sets editingTemplate to 'new'
     - handleTemplateSaved() - clears editingTemplate, returns to dashboard
     - handleTemplateCancel() - clears editingTemplate, returns to dashboard
   - Render TemplateEditorSurface when editingTemplate is set:
     - Pass template prop (undefined if 'new', otherwise the template)
     - Pass onSave={handleTemplateSaved}
     - Pass onCancel={handleTemplateCancel}
   - Connect DashboardSurface callbacks to surface navigation

Note: For now, test surface switching manually. Auth integration remains in Phase 12.
  </action>
  <verify>npm run build succeeds, TypeScript passes</verify>
  <done>Surface routing works - can navigate between dashboard and template editor</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] TemplateEditorSurface.tsx has editingTemplate state
- [ ] Save button calls window.templates service
- [ ] Cancel button triggers onCancel callback
- [ ] Surface routing in main.tsx switches between dashboard and editor
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Template editor container renders with form and header
- Navigation between surfaces works
</success_criteria>

<output>
After completion, create `.planning/phases/08-template-editor-surface/08-01-SUMMARY.md`
</output>
