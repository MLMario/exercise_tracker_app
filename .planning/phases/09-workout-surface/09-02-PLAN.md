---
phase: 09-workout-surface
plan: 02
type: execute
depends_on: ["09-01"]
files_modified: [src/surfaces/workout/WorkoutExerciseCard.tsx, src/surfaces/workout/SetRow.tsx, src/surfaces/workout/WorkoutSurface.tsx]
---

<objective>
Create exercise card and set row components for active workout with set management.

Purpose: Enable users to view and modify exercises and sets during an active workout.
Output: WorkoutExerciseCard and SetRow components with add/remove set functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-workout-surface/09-01-SUMMARY.md

# Prior patterns:
@src/surfaces/template-editor/ExerciseEditor.tsx
@src/surfaces/template-editor/ExerciseList.tsx

# Existing code to migrate:
@js/app.js (lines 733-770: addSetToExercise, removeSetFromExercise, generateSetsArray)
@index.html (lines 538-646: exercise card and set table HTML structure)

# Current workout surface:
@src/surfaces/workout/WorkoutSurface.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SetRow component</name>
  <files>src/surfaces/workout/SetRow.tsx</files>
  <action>
Create SetRow.tsx as a presentational component for a single set row.

**Props interface:**
```typescript
interface SetRowProps {
  set: WorkoutSet;
  exerciseIndex: number;
  setIndex: number;
  canDelete: boolean; // true if exercise has more than 1 set
  onWeightChange: (exerciseIndex: number, setIndex: number, weight: number) => void;
  onRepsChange: (exerciseIndex: number, setIndex: number, reps: number) => void;
  onToggleDone: (exerciseIndex: number, setIndex: number) => void;
  onDelete: (exerciseIndex: number, setIndex: number) => void;
}
```

**Render (match index.html lines 579-615):**
- Wrapper div with class "set-row-wrapper" (swipe handlers added in Plan 04)
- Inner div with class "set-row" and conditional "set-done" class when is_done
- Set number span
- Weight input (type="number", min=0, step=0.5)
- Reps input (type="number", min=0)
- Checkbox button with conditional "checked" class
- Delete button (only visible when canDelete is true)

**Event handlers:**
- Weight input onChange: call onWeightChange with parsed number
- Reps input onChange: call onRepsChange with parsed number
- Checkbox button onClick: call onToggleDone
- Delete button onClick: call onDelete

Note: Do NOT add swipe gesture handlers yet - those will be added in Plan 04.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>SetRow.tsx created with inputs, checkbox, delete button, all handlers wired</done>
</task>

<task type="auto">
  <name>Task 2: Create WorkoutExerciseCard component</name>
  <files>src/surfaces/workout/WorkoutExerciseCard.tsx</files>
  <action>
Create WorkoutExerciseCard.tsx for displaying one exercise with its sets.

**Props interface:**
```typescript
interface WorkoutExerciseCardProps {
  exercise: WorkoutExercise;
  exerciseIndex: number;
  // Set management
  onWeightChange: (exerciseIndex: number, setIndex: number, weight: number) => void;
  onRepsChange: (exerciseIndex: number, setIndex: number, reps: number) => void;
  onToggleDone: (exerciseIndex: number, setIndex: number, restSeconds: number) => void;
  onAddSet: (exerciseIndex: number) => void;
  onDeleteSet: (exerciseIndex: number, setIndex: number) => void;
  // Exercise removal
  onRemoveExercise: (exerciseIndex: number) => void;
  // Timer display (passed down, actual timer logic in Plan 03)
  timerDisplay?: string; // Formatted time to show
  timerProgress?: number; // 0-100 for progress bar
  isTimerActive?: boolean;
  onAdjustTimer?: (seconds: number, exerciseIndex: number) => void;
}
```

**Render (match index.html lines 540-646):**
- Card container with class "card exercise-workout-card"
- Exercise header:
  - Exercise name and category badge
  - Remove exercise button (X icon)
- Set table:
  - Header row: Set, lbs, Reps, (empty for checkbox)
  - Map exercise.sets to SetRow components
- Rest timer bar placeholder (actual implementation in Plan 03):
  - Container div with class "rest-timer-bar-container"
  - Simple placeholder showing rest_seconds
- Add Set button at bottom

**Handler calls:**
- Remove exercise button: onRemoveExercise(exerciseIndex)
- Add Set button: onAddSet(exerciseIndex)
- SetRow callbacks: forward to parent handlers
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>WorkoutExerciseCard.tsx created with set table, all handlers, timer placeholder</done>
</task>

<task type="auto">
  <name>Task 3: Integrate components into WorkoutSurface</name>
  <files>src/surfaces/workout/WorkoutSurface.tsx</files>
  <action>
Add set and exercise management handlers to WorkoutSurface and render exercise cards.

**Add handlers (from js/app.js lines 743-905):**

```typescript
// Add set to exercise (lines 743-752)
const handleAddSet = (exerciseIndex: number): void => {
  setActiveWorkout(prev => {
    const updated = { ...prev };
    const exercise = updated.exercises[exerciseIndex];
    const lastSet = exercise.sets[exercise.sets.length - 1];
    exercise.sets = [...exercise.sets, {
      set_number: exercise.sets.length + 1,
      weight: lastSet?.weight || 0,
      reps: lastSet?.reps || 10,
      is_done: false
    }];
    return updated;
  });
};

// Delete set from exercise (lines 755-762)
const handleDeleteSet = (exerciseIndex: number, setIndex: number): void => {
  setActiveWorkout(prev => {
    const updated = { ...prev };
    const exercise = updated.exercises[exerciseIndex];
    if (exercise.sets.length > 1) {
      exercise.sets = exercise.sets.filter((_, i) => i !== setIndex);
      // Renumber remaining sets
      exercise.sets.forEach((set, i) => set.set_number = i + 1);
    }
    return updated;
  });
};

// Update set weight
const handleWeightChange = (exerciseIndex: number, setIndex: number, weight: number): void => {
  setActiveWorkout(prev => {
    const updated = { ...prev };
    updated.exercises[exerciseIndex].sets[setIndex].weight = weight;
    return updated;
  });
};

// Update set reps
const handleRepsChange = (exerciseIndex: number, setIndex: number, reps: number): void => {
  setActiveWorkout(prev => {
    const updated = { ...prev };
    updated.exercises[exerciseIndex].sets[setIndex].reps = reps;
    return updated;
  });
};

// Toggle set done (timer integration in Plan 03)
const handleToggleDone = (exerciseIndex: number, setIndex: number, restSeconds: number): void => {
  setActiveWorkout(prev => {
    const updated = { ...prev };
    const set = updated.exercises[exerciseIndex].sets[setIndex];
    set.is_done = !set.is_done;
    // Timer start will be added in Plan 03
    return updated;
  });
};

// Remove exercise from workout (lines 898-905)
const handleRemoveExercise = (index: number): void => {
  // Timer stop will be added in Plan 03
  setActiveWorkout(prev => ({
    ...prev,
    exercises: prev.exercises.filter((_, i) => i !== index)
  }));
};
```

**Update render:**
- Import and render WorkoutExerciseCard for each exercise in activeWorkout.exercises
- Pass all handlers as props
- Show empty state when exercises.length === 0
- Keep "Add Exercise" button (handler in Plan 05)
  </action>
  <verify>npm run build succeeds, exercise cards render with sets, can add/remove sets and modify values</verify>
  <done>Exercise cards render in workout, set management works (add, remove, update weight/reps, toggle done)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] Exercise cards render for all exercises in template
- [ ] Can modify weight and reps values
- [ ] Can toggle set done checkbox
- [ ] Can add new sets to exercise
- [ ] Can delete sets (when more than 1)
- [ ] Can remove exercise from workout
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Exercise cards display correctly with all sets
- Set management (add, delete, edit) works
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-workout-surface/09-02-SUMMARY.md`
</output>
