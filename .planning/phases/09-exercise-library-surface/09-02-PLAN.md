---
phase: 09-exercise-library-surface
plan: 02
type: execute
depends_on: ["09-01"]
files_modified: [src/surfaces/exercise-library/ExerciseLibrarySurface.tsx, src/surfaces/exercise-library/CreateExerciseForm.tsx, src/surfaces/dashboard/DashboardSurface.tsx, src/surfaces/index.ts]
domain: preact
---

<objective>
Add exercise creation form, delete functionality, and dashboard navigation integration.

Purpose: Complete the exercise library surface with CRUD operations and wire it into the app navigation. This exposes the existing deleteExercise service method through the UI.

Output: Working ExerciseLibrarySurface with create/delete, navigable from dashboard.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-exercise-library-surface/09-01-SUMMARY.md

# Patterns to follow:
@src/components/ExercisePickerModal.tsx
@src/surfaces/dashboard/DashboardSurface.tsx
@src/services/exercises.ts

**Tech stack available:** Preact, TypeScript, exercises service with createExercise/deleteExercise
**Established patterns:**
- Modal with form for creation (AddChartModal, ExercisePickerModal inline form)
- Confirm dialog before delete (DashboardSurface.handleDeleteTemplate)
- Navigation callbacks between surfaces (onEditTemplate, onCreateNewTemplate pattern)

**Key decisions from prior phases:**
- ExerciseCategory type cast needed when calling createExercise (Phase 8)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CreateExerciseForm component and integrate with surface</name>
  <files>src/surfaces/exercise-library/CreateExerciseForm.tsx, src/surfaces/exercise-library/ExerciseLibrarySurface.tsx, src/surfaces/exercise-library/index.ts</files>
  <action>
Create inline form for new exercise creation:

1. Create `CreateExerciseForm.tsx`:
   - Props interface CreateExerciseFormProps:
     - onSubmit: (name: string, category: string) => Promise&lt;void&gt;
     - onCancel: () => void
     - isSubmitting: boolean
     - error: string

   State:
   - name: string (controlled input)
   - category: string (controlled select)

   Category options (from ExercisePickerModal):
   ```typescript
   const CATEGORY_OPTIONS = ['Legs', 'Chest', 'Back', 'Shoulders', 'Arms', 'Core', 'Cardio', 'Other'] as const;
   ```

   Render structure (following ExercisePickerModal new exercise form pattern):
   - Container div with class="create-exercise-form"
   - Form with onSubmit handler
   - Error display if error prop
   - Name input: type="text", class="input", placeholder="e.g., Barbell Squat", required
   - Category select: class="input", required, with options from CATEGORY_OPTIONS
   - Form actions: Cancel button (btn btn-secondary), Create button (btn btn-primary, disabled if isSubmitting)

2. Update `ExerciseLibrarySurface.tsx`:
   - Add state: showCreateForm: boolean, isCreating: boolean, createError: string
   - Add handler handleCreateExercise(name, category):
     - Set isCreating = true, createError = ''
     - Call window.exercises.createExercise(name, category as ExerciseCategory)
     - Import ExerciseCategory from @/types
     - On success: reload exercises, hide form, clear error
     - On error: set createError
     - Finally: set isCreating = false

   - Add "Create Exercise" button above the grid:
     - If !showCreateForm: Button to open form
     - If showCreateForm: Render CreateExerciseForm

   - Wire up CreateExerciseForm:
     - onSubmit={handleCreateExercise}
     - onCancel={() => setShowCreateForm(false)}
     - isSubmitting={isCreating}
     - error={createError}

3. Update `index.ts`:
   - Add: export { CreateExerciseForm } from './CreateExerciseForm'
  </action>
  <verify>npx tsc --noEmit passes, can open create form and submit creates new exercise</verify>
  <done>Create exercise form shows, validates inputs, calls service, reloads list on success</done>
</task>

<task type="auto">
  <name>Task 2: Add delete exercise functionality with confirmation</name>
  <files>src/surfaces/exercise-library/ExerciseLibrarySurface.tsx, src/surfaces/exercise-library/ExerciseCard.tsx</files>
  <action>
Add delete functionality for custom exercises:

1. Update `ExerciseLibrarySurface.tsx`:
   - Add state: showDeleteModal: boolean, pendingDeleteId: string | null
   - Add handler handleDeleteClick(id: string):
     - Set pendingDeleteId = id
     - Set showDeleteModal = true

   - Add handler confirmDelete():
     - Get id from pendingDeleteId
     - Set showDeleteModal = false, pendingDeleteId = null
     - If !id return
     - Call window.exercises.deleteExercise(id)
     - On success: reload exercises
     - On error: set error state

   - Add handler dismissDeleteModal():
     - Set showDeleteModal = false, pendingDeleteId = null

   - Pass onDelete={handleDeleteClick} to ExerciseCard components

   - Add delete confirmation modal (following DashboardSurface pattern):
     ```tsx
     {showDeleteModal && (
       <div class="modal-overlay" onClick={dismissDeleteModal}>
         <div class="modal-content delete-confirm-modal" onClick={(e) => e.stopPropagation()}>
           <div class="modal-header">
             <h2>Delete Exercise</h2>
           </div>
           <div class="modal-body">
             <p>Are you sure you want to delete this exercise?</p>
             <p class="text-warning">This cannot be undone.</p>
           </div>
           <div class="modal-actions">
             <button type="button" class="btn btn-secondary" onClick={dismissDeleteModal}>
               Cancel
             </button>
             <button type="button" class="btn btn-danger" onClick={confirmDelete}>
               Delete
             </button>
           </div>
         </div>
       </div>
     )}
     ```

2. Update `ExerciseCard.tsx` if needed:
   - Ensure delete button only shows for custom exercises (isCustom && onDelete)
   - Button should be styled subtly (btn-icon btn-danger-subtle or similar)
  </action>
  <verify>npm run build passes, delete button shows only on custom exercises, confirmation modal works</verify>
  <done>Delete button on custom exercises opens confirmation modal, deletion removes exercise from list</done>
</task>

<task type="auto">
  <name>Task 3: Add dashboard navigation to exercise library</name>
  <files>src/surfaces/dashboard/DashboardSurface.tsx, src/surfaces/index.ts</files>
  <action>
Wire up navigation from dashboard to exercise library:

1. Update `DashboardSurface.tsx`:
   - Add prop: onOpenExerciseLibrary?: () => void

   - In the exercises-info section (currently a placeholder), add a button:
     ```tsx
     <section class="exercises-section">
       <div class="section-header">
         <h2>Exercises</h2>
         {onOpenExerciseLibrary && (
           <button
             type="button"
             class="btn btn-secondary"
             onClick={onOpenExerciseLibrary}
           >
             Manage Exercises
           </button>
         )}
       </div>
       <p class="exercise-count">
         {availableExercises.length} exercise(s) available
       </p>
     </section>
     ```

   - Update DashboardSurfaceProps interface to include onOpenExerciseLibrary

2. Update `src/surfaces/index.ts`:
   - Add: export * from './exercise-library'
   - This allows main.tsx to import ExerciseLibrarySurface when navigation is wired

Note: Full navigation wiring (surface switching) will be done in Phase 12 (Integration).
For now, expose the callback so it can be connected later.
  </action>
  <verify>npm run build passes, DashboardSurface has "Manage Exercises" button that calls onOpenExerciseLibrary</verify>
  <done>Dashboard shows "Manage Exercises" button in exercises section, callback prop available for navigation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] CreateExerciseForm.tsx exists and works
- [ ] Delete modal shows and deletes custom exercises
- [ ] DashboardSurface has navigation callback for exercise library
- [ ] All components exported from surfaces/index.ts
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Create exercise form validates and creates exercises
- Delete only available for custom exercises (user_id !== null)
- Delete confirmation modal prevents accidental deletion
- Dashboard has "Manage Exercises" navigation ready
- Phase 9 complete
</success_criteria>

<output>
After completion, create `.planning/phases/09-exercise-library-surface/09-02-SUMMARY.md`
</output>
