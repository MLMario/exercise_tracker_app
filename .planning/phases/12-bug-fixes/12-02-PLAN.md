---
phase: 12-bug-fixes
plan: 02
type: execute
depends_on: []
files_modified: [src/types/services.ts, src/services/logging.ts, src/main.tsx, src/services/auth.ts, src/surfaces/auth/AuthSurface.tsx, src/services/exercises.ts, src/services/templates.ts, src/surfaces/workout/WorkoutSurface.tsx, js/auth.js]
---

<objective>
Fix chart "Max Weight" metric bug and remove debug console.log statements.

Purpose: Complete the Max Weight chart feature and clean up production code.
Output: Max Weight charts display data correctly, no debug logging in console.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-bug-fixes/CONTEXT.md
@src/types/services.ts
@src/services/logging.ts

**Bug Analysis:**

1. **Chart Max Weight (logging.ts:504-521)**: The `getExerciseMetrics` function only handles 'total_sets' and 'max_volume_set' metrics. When metric is 'max_weight', no value is pushed to the array, resulting in empty chart data.

2. **Console Logging**: Debug console.log statements scattered across multiple files:
   - src/main.tsx (lines 15, 134, 161, 308)
   - src/services/auth.ts (lines 145, 298)
   - src/surfaces/auth/AuthSurface.tsx (line 82)
   - src/services/exercises.ts (line 236)
   - src/services/logging.ts (line 647)
   - src/services/templates.ts (line 740)
   - src/surfaces/workout/WorkoutSurface.tsx (line 205)
   - js/auth.js (lines 132, 276) - legacy service still in use
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Max Weight metric in getExerciseMetrics</name>
  <files>src/types/services.ts, src/services/logging.ts</files>
  <action>
**Step 1 - Update ExerciseMetricType (src/types/services.ts around line 461):**
Add 'max_weight' to the union type:
```typescript
export type ExerciseMetricType = 'total_sets' | 'max_volume_set' | 'max_weight';
```

**Step 2 - Handle max_weight in getExerciseMetrics (src/services/logging.ts):**
In the `getExerciseMetrics` function, add handling for 'max_weight' metric.

For date mode (around line 504-508), add:
```typescript
} else if (metric === 'max_weight') {
  values.push(item.max_weight);
}
```

For session mode (around line 517-521), add:
```typescript
} else if (metric === 'max_weight') {
  values.push(item.max_weight);
}
```

The `ExerciseHistoryDateData` and `ExerciseHistorySessionData` types already include `max_weight` field (calculated by calculateMetrics helper).
  </action>
  <verify>`npm run build` succeeds, TypeScript compiles without errors</verify>
  <done>Max Weight metric option in charts displays data correctly</done>
</task>

<task type="auto">
  <name>Task 2: Remove debug console.log statements</name>
  <files>src/main.tsx, src/services/auth.ts, src/surfaces/auth/AuthSurface.tsx, src/services/exercises.ts, src/services/logging.ts, src/services/templates.ts, src/surfaces/workout/WorkoutSurface.tsx, js/auth.js</files>
  <action>
Remove ALL console.log statements from these files. Use search-and-delete pattern.

**src/main.tsx:**
- Line 15: `console.log('Vite + TypeScript initialized');` → DELETE
- Line 134: `console.log('[APP] Auth state change:', event);` → DELETE
- Line 161: `console.log('[APP] Found saved workout, restoring...');` → DELETE
- Line 308: `console.log('App rendered to #app');` → DELETE

**src/services/auth.ts:**
- Line 145: `console.log('[AUTH DEBUG] resetPasswordForEmail redirectTo:', redirectTo);` → DELETE
- Line 298: `console.log('Auth module loaded successfully');` → DELETE

**src/surfaces/auth/AuthSurface.tsx:**
- Line 82: `console.log('[AUTH DEBUG] Detected recovery token in URL...');` → DELETE

**src/services/exercises.ts:**
- Line 236: `console.log('Exercises module loaded successfully');` → DELETE

**src/services/logging.ts:**
- Line 647: `console.log('Logging module loaded successfully');` → DELETE

**src/services/templates.ts:**
- Line 740: `console.log('Templates module loaded successfully');` → DELETE

**src/surfaces/workout/WorkoutSurface.tsx:**
- Line 205: `console.log('[WorkoutSurface] Restoring workout from saved data');` → DELETE

**js/auth.js (legacy service):**
- Line 132: `console.log('[AUTH DEBUG] resetPasswordForEmail redirectTo:', redirectTo);` → DELETE
- Line 276: `console.log('Auth module loaded successfully');` → DELETE

NOTE: Keep console.error statements - those are for actual error logging. Only remove console.log (debug/info logging).
  </action>
  <verify>`npm run build` succeeds, grep for remaining console.log: `grep -r "console\.log" src/ js/auth.js` returns no matches</verify>
  <done>No console.log statements remain in source files (console.error for actual errors is acceptable)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] `grep -r "console\.log" src/` returns no matches
- [ ] `grep "console\.log" js/auth.js` returns no matches
</verification>

<success_criteria>

- All tasks completed
- ExerciseMetricType includes 'max_weight'
- getExerciseMetrics handles 'max_weight' in both date and session modes
- No console.log statements in src/ or js/auth.js
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/12-bug-fixes/12-02-SUMMARY.md`:

# Plan 12-02 Summary: Chart Fix and Console Cleanup

**Added max_weight metric support and removed debug logging**

## Accomplishments

- [Key outcomes]

## Files Modified

- `src/types/services.ts` - Added 'max_weight' to ExerciseMetricType
- `src/services/logging.ts` - Added max_weight handling in getExerciseMetrics
- [List all files with console.log removed]

## Decisions Made

[Key decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 12 complete, ready for Phase 13: UI Polish
</output>
