---
phase: 05-data-services
plan: 01
type: execute
depends_on: []
files_modified: [src/services/exercises.ts, src/services/index.ts]
---

<objective>
Migrate exercises service from js/exercises.js to TypeScript with full type safety.

Purpose: Enable type-safe exercise CRUD operations using established patterns from auth service.
Output: Working exercises service with backward compatibility via window.exercises export.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-auth-service/04-01-SUMMARY.md

# Type definitions already exist:
@src/types/database.ts
@src/types/services.ts

# Pattern to follow:
@src/services/auth.ts

# Source to migrate:
@js/exercises.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create exercises service module</name>
  <files>src/services/exercises.ts</files>
  <action>
Create TypeScript implementation of ExercisesService interface from src/types/services.ts.

Implement all 6 functions with exact behavioral parity to js/exercises.js:
1. getExercises() - Fetch all exercises ordered by name
2. getExercisesByCategory(category) - Filter by category
3. createExercise(name, category, equipment) - Create with user_id from auth, handle unique constraint (23505)
4. deleteExercise(id) - Delete by ID with validation
5. exerciseExists(name) - Check existence using maybeSingle()
6. getCategories() - Return static array of ExerciseCategory

Follow auth.ts patterns:
- Import types from @/types/services and @/types/database
- Import supabase from @/lib/supabase
- Use try/catch with console.error logging (preserve exact debug output style)
- Return ServiceResult<T> or ServiceError types
- Export as `exercises` object implementing ExercisesService
- Add window.exercises export for backward compatibility with declare global

AVOID: Don't add new validation beyond what exists in js/exercises.js. The unique constraint check (error.code === '23505') must be preserved exactly.
  </action>
  <verify>npx tsc --noEmit passes without errors</verify>
  <done>All 6 functions implemented with exact behavioral parity to js/exercises.js</done>
</task>

<task type="auto">
  <name>Task 2: Update barrel export and verify build</name>
  <files>src/services/index.ts</files>
  <action>
Add exercises service to the barrel export:
- Export { exercises } from './exercises'
- Also export the ExercisesService type from the module

Verify the complete build succeeds.
  </action>
  <verify>npm run build succeeds without errors or warnings</verify>
  <done>Exercises service exported via barrel, build passes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` succeeds
- [ ] All 6 ExercisesService interface methods implemented
- [ ] window.exercises backward compatibility export present
- [ ] No behavioral changes from js/exercises.js
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Exercises service matches ExercisesService interface
- Backward compatible with existing js/app.js usage
</success_criteria>

<output>
After completion, create `.planning/phases/05-data-services/05-01-SUMMARY.md`
</output>
