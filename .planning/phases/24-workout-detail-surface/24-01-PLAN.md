---
phase: 24-workout-detail-surface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/surfaces/dashboard/WorkoutDetail.tsx
  - apps/web/src/surfaces/dashboard/SettingsPanel.tsx
  - apps/web/css/styles.css
autonomous: true

must_haves:
  truths:
    - "User sees workout header with template name (or 'Untitled Workout') and formatted date"
    - "User sees each exercise as a distinct block with exercise name header"
    - "User sees set grid showing set number, weight, reps, and completion icon for each set"
    - "User can distinguish completed sets (checkmark) from skipped sets (X icon)"
    - "User can tap back button to return to history list"
  artifacts:
    - path: "apps/web/src/surfaces/dashboard/WorkoutDetail.tsx"
      provides: "Workout detail component with header, exercise blocks, set grids"
      exports: ["WorkoutDetail"]
    - path: "apps/web/css/styles.css"
      provides: "Workout detail styles"
      contains: ".workout-detail"
  key_links:
    - from: "apps/web/src/surfaces/dashboard/SettingsPanel.tsx"
      to: "WorkoutDetail"
      via: "import and render when panelView is 'workout-detail'"
      pattern: "import.*WorkoutDetail"
    - from: "apps/web/src/surfaces/dashboard/SettingsPanel.tsx"
      to: "WorkoutHistoryList"
      via: "onSelectWorkout callback wired"
      pattern: "onSelectWorkout.*setSelectedWorkoutId"
    - from: "apps/web/src/surfaces/dashboard/WorkoutDetail.tsx"
      to: "@ironlift/shared logging service"
      via: "logging.getWorkoutLog(workoutId)"
      pattern: "logging\\.getWorkoutLog"
---

<objective>
Build the WorkoutDetail component that displays a full workout breakdown with exercise blocks and set completion status when user taps a workout card from the history list.

Purpose: This is the detailed view surface where users can see exactly what they did in a past workout - which exercises, how many sets, weights, reps, and whether each set was completed or skipped.

Output:
- WorkoutDetail.tsx component
- Workout detail CSS styles in styles.css
- SettingsPanel navigation wired with 'workout-detail' view
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-workout-detail-surface/24-RESEARCH.md
@apps/web/src/surfaces/dashboard/SettingsPanel.tsx
@apps/web/src/surfaces/dashboard/WorkoutHistoryList.tsx
@packages/shared/src/types/database.ts (WorkoutLogWithExercises, WorkoutLogExerciseWithSets, WorkoutLogSetData)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkoutDetail component</name>
  <files>apps/web/src/surfaces/dashboard/WorkoutDetail.tsx</files>
  <action>
Create WorkoutDetail.tsx that displays a full workout breakdown with exercise blocks and set grids.

**Props:**
```typescript
interface WorkoutDetailProps {
  workoutId: string;
  onBack: () => void;
}
```

**State:**
- workout: WorkoutLogWithExercises | null
- isLoading: boolean
- error: string

**Data fetching:**
- useEffect on workoutId change: call `logging.getWorkoutLog(workoutId)`
- Handle loading, error, and success states

**Render structure:**
1. Loading state: "Loading workout..." centered text (reuse .my-exercises-loading class)
2. Error state: error message with .error-message class
3. Content (when workout loaded):
   - div.workout-detail-header:
     - h2.workout-detail-title: "Untitled Workout" (template name not available in getWorkoutLog)
     - span.workout-detail-date: formatted date (e.g., "Feb 5, 2026")
   - div.workout-detail-exercises:
     - For each exercise in workout.workout_log_exercises:
       - div.exercise-block:
         - div.exercise-block-header:
           - span.exercise-block-name: exercise.exercises.name
           - span.exercise-block-category (with data-category attribute for color): exercise.exercises.category
         - div.set-grid:
           - div.set-grid-header (column labels): Set | Weight | Reps | Status
           - For each set in exercise.workout_log_sets:
             - div.set-grid-row:
               - span.set-cell: set.set_number
               - span.set-cell: set.weight + " lbs"
               - span.set-cell: set.reps
               - span.set-cell.set-status:
                 - If is_done: checkmark SVG with .status-done class
                 - Else: X SVG with .status-skipped class

**Utility function (inline):**
```typescript
function formatDetailDate(isoString: string): string {
  const date = new Date(isoString);
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric'  // "Feb 5, 2026"
  });
}
```

**Imports:**
```typescript
import { useState, useEffect } from 'preact/hooks';
import type { WorkoutLogWithExercises } from '@ironlift/shared';
import { logging } from '@ironlift/shared';
```

**SVG icons (inline in component):**
- Checkmark: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"></path></svg>`
- X mark: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6L6 18M6 6l12 12"></path></svg>`

**Note:** The onBack prop is passed but not used directly by WorkoutDetail - the back button is in the SettingsPanel header. This prop is for future flexibility if the component needs to trigger navigation.
  </action>
  <verify>
- File exists at apps/web/src/surfaces/dashboard/WorkoutDetail.tsx
- TypeScript compiles without errors: `cd apps/web && npx tsc --noEmit`
- Component exports WorkoutDetail function
  </verify>
  <done>
WorkoutDetail component created with:
- Header showing "Untitled Workout" and formatted date
- Exercise blocks with name and category
- Set grid with columns: Set #, Weight, Reps, Status icon
- Checkmark for completed sets, X for skipped sets
- Loading and error states
  </done>
</task>

<task type="auto">
  <name>Task 2: Add workout detail CSS styles</name>
  <files>apps/web/css/styles.css</files>
  <action>
Add CSS styles at the end of styles.css for the workout detail surface. Match the existing app styling conventions.

**Add these style blocks:**

```css
/* ==========================================================================
   Workout Detail
   ========================================================================== */

.workout-detail-header {
  padding: var(--spacing-md) var(--spacing-lg);
  border-bottom: 1px solid var(--color-border);
}

.workout-detail-title {
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 4px 0;
}

.workout-detail-date {
  font-size: 0.8125rem;
  color: var(--color-text-muted);
  font-family: var(--font-mono);
}

.workout-detail-exercises {
  padding: var(--spacing-md);
}

.exercise-block {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border-dim);
  border-radius: var(--radius-lg);
  margin-bottom: var(--spacing-md);
  overflow: hidden;
}

.exercise-block:last-child {
  margin-bottom: 0;
}

.exercise-block-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--color-bg-primary);
  border-bottom: 1px solid var(--color-border-dim);
}

.exercise-block-name {
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--color-text-primary);
}

.exercise-block-category {
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  padding: 2px 8px;
  border-radius: var(--radius-full);
  background: rgba(107, 114, 128, 0.15);
  color: var(--color-text-muted);
}

/* Category colors */
.exercise-block-category[data-category="Chest"] {
  background: rgba(239, 68, 68, 0.15);
  color: #ef4444;
}

.exercise-block-category[data-category="Back"] {
  background: rgba(59, 130, 246, 0.15);
  color: #3b82f6;
}

.exercise-block-category[data-category="Shoulders"] {
  background: rgba(249, 115, 22, 0.15);
  color: #f97316;
}

.exercise-block-category[data-category="Legs"] {
  background: rgba(34, 197, 94, 0.15);
  color: #22c55e;
}

.exercise-block-category[data-category="Arms"] {
  background: rgba(168, 85, 247, 0.15);
  color: #a855f7;
}

.exercise-block-category[data-category="Core"] {
  background: rgba(234, 179, 8, 0.15);
  color: #eab308;
}

/* Set grid */
.set-grid {
  padding: var(--spacing-sm);
}

.set-grid-header {
  display: grid;
  grid-template-columns: 48px 1fr 1fr 48px;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--color-text-muted);
  border-bottom: 1px solid var(--color-border-dim);
  margin-bottom: var(--spacing-xs);
}

.set-grid-row {
  display: grid;
  grid-template-columns: 48px 1fr 1fr 48px;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  align-items: center;
}

.set-grid-row:nth-child(odd) {
  background: var(--color-bg-primary);
  border-radius: var(--radius-sm);
}

.set-cell {
  font-size: 0.875rem;
  color: var(--color-text-primary);
  font-family: var(--font-mono);
}

.set-cell:first-child {
  font-weight: 600;
  color: var(--color-text-muted);
}

.set-status {
  display: flex;
  justify-content: center;
}

.status-done {
  color: var(--color-success);
}

.status-skipped {
  color: var(--color-danger);
}
```
  </action>
  <verify>
- CSS added to end of styles.css
- No syntax errors (check browser dev tools after starting app)
- Variables reference existing CSS custom properties
  </verify>
  <done>
Workout detail CSS styles added including:
- Header layout with title and date
- Exercise block styling
- Category color badges (7 categories)
- Set grid with header and data rows
- Status icons (done=green checkmark, skipped=red X)
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire navigation in SettingsPanel</name>
  <files>apps/web/src/surfaces/dashboard/SettingsPanel.tsx</files>
  <action>
Update SettingsPanel to support workout-detail navigation with the new WorkoutDetail component.

**Changes:**

1. Add import at top:
```typescript
import { WorkoutDetail } from './WorkoutDetail';
```

2. Update PanelView type:
```typescript
type PanelView = 'menu' | 'exercises' | 'history' | 'workout-detail';
```

3. Add selectedWorkoutId state (after existing state declarations):
```typescript
const [selectedWorkoutId, setSelectedWorkoutId] = useState<string | null>(null);
```

4. Add workout selection handler:
```typescript
const handleSelectWorkout = (workoutId: string) => {
  setSelectedWorkoutId(workoutId);
  setPanelView('workout-detail');
};
```

5. Update handleBack to handle workout-detail -> history transition:
```typescript
const handleBack = () => {
  if (isCreating) return;
  if (panelView === 'workout-detail') {
    setPanelView('history');
    setSelectedWorkoutId(null);
  } else if (panelView === 'exercises' || panelView === 'history') {
    setPanelView('menu');
  } else {
    onClose();
  }
};
```

6. Update headerTitle logic:
```typescript
const headerTitle =
  panelView === 'menu' ? 'Settings' :
  panelView === 'exercises' ? 'My Exercises' :
  panelView === 'workout-detail' ? 'Workout Details' :
  'Workout History';
```

7. Update backLabel logic:
```typescript
const backLabel =
  panelView === 'menu' ? 'Back' :
  panelView === 'workout-detail' ? 'History' :
  'Settings';
```

8. Wire onSelectWorkout callback to WorkoutHistoryList:
```typescript
{panelView === 'history' && (
  <WorkoutHistoryList onSelectWorkout={handleSelectWorkout} />
)}
```

9. Add WorkoutDetail rendering (after history section):
```typescript
{panelView === 'workout-detail' && selectedWorkoutId && (
  <WorkoutDetail
    workoutId={selectedWorkoutId}
    onBack={() => {
      setPanelView('history');
      setSelectedWorkoutId(null);
    }}
  />
)}
```

10. Update the useEffect that resets state on panel close to also clear selectedWorkoutId:
```typescript
useEffect(() => {
  if (!isOpen) {
    const timer = setTimeout(() => {
      setPanelView('menu');
      setSelectedWorkoutId(null);
      if (!isCreating) {
        setShowCreateModal(false);
      }
    }, 250);
    return () => clearTimeout(timer);
  }
}, [isOpen, isCreating]);
```
  </action>
  <verify>
- Import statement added for WorkoutDetail
- PanelView type includes 'workout-detail'
- selectedWorkoutId state added
- handleBack handles workout-detail -> history
- headerTitle and backLabel updated
- onSelectWorkout wired to WorkoutHistoryList
- WorkoutDetail rendered conditionally
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- App runs: `cd apps/web && npm run dev`
  </verify>
  <done>
SettingsPanel navigation wired:
- 'workout-detail' added to PanelView
- Tapping history card navigates to workout detail
- Back button returns to history list
- Header shows "Workout Details" with "History" back label
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compilation:**
   ```bash
   cd apps/web && npx tsc --noEmit
   ```

2. **Visual verification:**
   - Start dev server: `cd apps/web && npm run dev`
   - Navigate to Settings > Workout History
   - Tap a workout card
   - Verify header shows "Workout Details" with date
   - Verify each exercise is a distinct block with name header
   - Verify set grid shows Set #, Weight, Reps, Status columns
   - Verify completed sets have green checkmark
   - Verify skipped sets have red X
   - Tap back button and verify return to history list

3. **Requirements coverage:**
   - DETAIL-01: Workout header with "Untitled Workout" and date
   - DETAIL-02: Exercise blocks with exercise name headers
   - DETAIL-03: Set grid with Set #, Weight, Reps, Status
   - DETAIL-04: Visual distinction (checkmark vs X)
   - NAV-02: Back navigation to history list
</verification>

<success_criteria>
- WorkoutDetail component exists and renders
- Header shows "Untitled Workout" and formatted date
- Each exercise rendered as distinct block with name and category badge
- Set grid shows 4 columns: Set #, Weight (lbs), Reps, Status icon
- Completed sets show green checkmark, skipped sets show red X
- Tapping back returns to history list
- No TypeScript errors
- No console errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-workout-detail-surface/24-01-SUMMARY.md`
</output>
