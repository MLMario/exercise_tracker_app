---
phase: 25-extract-shared-package
plan: 01
type: execute
depends_on: []
files_modified: [packages/shared/package.json, packages/shared/tsconfig.json, packages/shared/src/index.ts]
---

<objective>
Extract types, services, and lib to @ironlift/shared package.

Purpose: Create the shared package that will be consumed by web app (and future iOS app), enabling code reuse across platforms.
Output: `packages/shared/` with all shared code, proper exports, and package configuration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-workspace-setup/24-01-SUMMARY.md

**Prior phase context:**
- pnpm workspace configured with packages/* and apps/* globs
- packages/ directory exists (empty except .gitkeep)
- Development workflow unchanged

**Files to move:**
- src/types/ → packages/shared/src/types/
- src/services/ → packages/shared/src/services/
- src/lib/ → packages/shared/src/lib/

**Current import pattern:** `@/types`, `@/services`, `@/lib/supabase`
**Note:** Import updates happen in Phase 27, not this phase.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared package structure</name>
  <files>packages/shared/package.json, packages/shared/tsconfig.json</files>
  <action>
Create `packages/shared/` with proper package configuration:

1. Create `packages/shared/package.json`:
   - name: "@ironlift/shared"
   - version: "0.0.1"
   - type: "module"
   - main: "src/index.ts" (source entry - Vite handles bundling)
   - types: "src/index.ts"
   - exports: { ".": "./src/index.ts", "./*": "./src/*" }
   - No build script needed - Vite in apps/web will handle transpilation
   - peerDependencies: @supabase/supabase-js (from root package.json)

2. Create `packages/shared/tsconfig.json`:
   - extends: "../../tsconfig.json" (inherit root config)
   - compilerOptions.rootDir: "src"
   - include: ["src/**/*"]

3. Create `packages/shared/src/` directory

Do NOT add a build step - this is a source-only package consumed by Vite.
  </action>
  <verify>
- packages/shared/package.json exists with @ironlift/shared name
- packages/shared/tsconfig.json exists extending root config
- packages/shared/src/ directory exists
  </verify>
  <done>Package structure created with proper configuration</done>
</task>

<task type="auto">
  <name>Task 2: Move shared code to package</name>
  <files>packages/shared/src/types/, packages/shared/src/services/, packages/shared/src/lib/</files>
  <action>
Move the three shared directories from src/ to packages/shared/src/:

1. Move src/types/ → packages/shared/src/types/
   - database.ts (Supabase schema types)
   - services.ts (Service interface types)
   - index.ts (barrel export)

2. Move src/services/ → packages/shared/src/services/
   - auth.ts, charts.ts, exercises.ts, logging.ts, templates.ts
   - index.ts (barrel export)

3. Move src/lib/ → packages/shared/src/lib/
   - supabase.ts (Supabase client)

Use `git mv` to preserve history. After moves, src/ should only contain:
- components/
- surfaces/
- main.tsx
- env.d.ts

Do NOT update any imports yet - that's Phase 27.
  </action>
  <verify>
- git status shows renamed files (not deleted + added)
- packages/shared/src/types/ contains database.ts, services.ts, index.ts
- packages/shared/src/services/ contains auth.ts, charts.ts, exercises.ts, logging.ts, templates.ts, index.ts
- packages/shared/src/lib/ contains supabase.ts
- src/ only contains components/, surfaces/, main.tsx, env.d.ts
  </verify>
  <done>All shared code moved with git history preserved</done>
</task>

<task type="auto">
  <name>Task 3: Create package barrel export</name>
  <files>packages/shared/src/index.ts</files>
  <action>
Create `packages/shared/src/index.ts` as the main barrel export:

```typescript
/**
 * @ironlift/shared
 *
 * Shared types, services, and utilities for IronFactor apps.
 */

// Types
export * from './types';

// Services
export * from './services';

// Lib
export { supabase } from './lib/supabase';
```

This provides a clean import surface for consumers:
- `import { auth, templates, Exercise } from '@ironlift/shared'`
- Individual paths still work: `import { supabase } from '@ironlift/shared/lib/supabase'`
  </action>
  <verify>
- packages/shared/src/index.ts exists with all exports
- TypeScript reports no errors: `pnpm exec tsc --noEmit -p packages/shared/tsconfig.json`
  </verify>
  <done>Barrel export created, TypeScript validates</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] packages/shared/package.json exists with correct name and exports
- [ ] packages/shared/tsconfig.json extends root config
- [ ] All files moved from src/types/, src/services/, src/lib/
- [ ] git log shows file moves (not delete + add)
- [ ] TypeScript validation passes for shared package
- [ ] src/ only contains components/, surfaces/, main.tsx, env.d.ts
</verification>

<success_criteria>

- All tasks completed
- Shared code extracted to packages/shared/
- Git history preserved for moved files
- Package is valid TypeScript (no compilation errors)
- Ready for Phase 26 (web app migration)
</success_criteria>

<output>
After completion, create `.planning/phases/25-extract-shared-package/25-01-SUMMARY.md`:

# Phase 25 Plan 01: Extract Shared Package Summary

**[One-liner describing what shipped]**

## Performance

- **Duration**: X minutes
- **Execution mode**: Autonomous (no checkpoints)

## Accomplishments

- [Key outcomes]

## Commits

| Task | Commit Hash | Message |
|------|-------------|---------|
| Task 1 | `hash` | feat(25-01): create shared package structure |
| Task 2 | `hash` | refactor(25-01): move types, services, lib to shared |
| Task 3 | `hash` | feat(25-01): create shared package barrel export |

## Files Created/Modified

**Created:**
- packages/shared/package.json
- packages/shared/tsconfig.json
- packages/shared/src/index.ts

**Moved:**
- src/types/* → packages/shared/src/types/*
- src/services/* → packages/shared/src/services/*
- src/lib/* → packages/shared/src/lib/*

## Decisions Made

[Any decisions, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Ready for Phase 26: Web App Migration
- packages/shared/ contains all shared code
- Import updates deferred to Phase 27
</output>
