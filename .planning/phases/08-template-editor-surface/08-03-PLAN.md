---
phase: 08-template-editor-surface
plan: 03
type: execute
depends_on: ["08-02"]
files_modified: [src/components/ExercisePickerModal.tsx, src/components/index.ts, src/surfaces/template-editor/TemplateEditorSurface.tsx]
---

<objective>
Create ExercisePickerModal shared component for selecting and creating exercises.

Purpose: Build a reusable modal for adding exercises to templates (and later, workouts).
Output: ExercisePickerModal component integrated into TemplateEditorSurface.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-template-editor-surface/08-02-SUMMARY.md

# Key reference files:
@src/surfaces/template-editor/TemplateEditorSurface.tsx
@src/surfaces/dashboard/AddChartModal.tsx (for modal pattern)
@index.html (lines 664-749 for exercise picker HTML)
@js/app.js (lines 538-691 for exercise picker methods)

**Tech stack available:** Preact, TypeScript
**Established patterns:** Modal components with isOpen, onClose, onSubmit props
**Constraining decisions:**
- AddChartModal established modal pattern with overlay, header, body, actions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExercisePickerModal component</name>
  <files>src/components/ExercisePickerModal.tsx, src/components/index.ts</files>
  <action>
Create src/components/ directory if needed, then ExercisePickerModal.tsx:

1. Props interface (ExercisePickerModalProps):
   - isOpen: boolean
   - exercises: Exercise[] (available exercises)
   - excludeIds?: string[] (already-added exercise IDs to disable/hide)
   - onClose: () => void
   - onSelect: (exercise: Exercise) => void
   - onCreateExercise?: (name: string, category: string) => Promise<Exercise | null>

2. State:
   - searchQuery: string (for filtering)
   - showNewExerciseForm: boolean
   - newExerciseName: string
   - newExerciseCategory: string
   - isCreating: boolean
   - error: string

3. Computed:
   - filteredExercises: filter exercises by searchQuery on name/category

4. Methods matching js/app.js:
   - handleSearch - updates searchQuery
   - handleSelect(exercise) - check if in excludeIds, if not call onSelect and onClose
   - toggleNewExerciseForm - toggle showNewExerciseForm
   - handleCreateExercise - validate, call onCreateExercise, auto-select new exercise

5. Render structure matching index.html lines 664-749:
   - Modal overlay (click to close)
   - Modal with header "Add Exercise" and close button
   - Search input
   - Scrollable exercise list (exercise-list-container)
   - Exercise items: name, category badge, click to select
   - Disabled style for exercises in excludeIds
   - Empty state when no matches
   - "Create New Exercise" toggle button
   - New exercise form (conditional): name input, category select, submit button
   - Category options: Legs, Chest, Back, Shoulders, Arms, Core, Cardio, Other

Create barrel export src/components/index.ts exporting ExercisePickerModal.
  </action>
  <verify>npx tsc --noEmit passes, modal renders with all elements</verify>
  <done>ExercisePickerModal has search, list, selection, and new exercise form</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ExercisePickerModal into TemplateEditorSurface</name>
  <files>src/surfaces/template-editor/TemplateEditorSurface.tsx</files>
  <action>
1. Add state for exercise picker:
   - showExercisePicker: boolean
   - availableExercises: Exercise[] (loaded on mount)

2. Add loadExercises method matching dashboard pattern:
   - Call window.exercises.getExercises()
   - Set availableExercises state

3. Call loadExercises in useEffect on mount.

4. Update handleOpenExercisePicker (from Plan 02):
   - Set showExercisePicker = true

5. Add handleSelectExercise(exercise: Exercise):
   Matching js/app.js lines 571-590:
   - Check if already added (exercise.id in editingTemplate.exercises)
   - If exists, show error
   - Otherwise, push new exercise object:
     { exercise_id, name, category, default_rest_seconds: 90,
       sets: [{ set_number: 1, weight: 0, reps: 10 }, ...3 sets] }
   - Close picker

6. Add handleCreateExercise(name, category):
   Matching js/app.js lines 656-691:
   - Call window.exercises.createExercise(name, category)
   - On success, add to availableExercises state
   - Return the new exercise (picker will auto-select)
   - On error, return null

7. Render ExercisePickerModal:
   - isOpen={showExercisePicker}
   - exercises={availableExercises}
   - excludeIds={editingTemplate.exercises.map(e => e.exercise_id)}
   - onClose={() => setShowExercisePicker(false)}
   - onSelect={handleSelectExercise}
   - onCreateExercise={handleCreateExercise}
  </action>
  <verify>npm run build succeeds, can add exercises via picker</verify>
  <done>Exercise picker opens, shows available exercises, allows adding to template</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] ExercisePickerModal.tsx exists in src/components/
- [ ] Modal opens when "Add Exercise" clicked
- [ ] Search filters exercise list
- [ ] Clicking exercise adds to template with 3 default sets
- [ ] Already-added exercises are disabled/indicated
- [ ] Can create new exercise via form
- [ ] New exercise auto-added to template
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Complete template editor flow works: create name, add exercises, save
- Phase 8 complete
</success_criteria>

<output>
After completion, create `.planning/phases/08-template-editor-surface/08-03-SUMMARY.md`
</output>
