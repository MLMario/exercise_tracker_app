---
phase: 31-exercise-card-accordion
plan: 01
type: execute
depends_on: []
files_modified: [apps/web/src/surfaces/workout/WorkoutExerciseCard.tsx, apps/web/css/styles.css]
---

<objective>
Refactor WorkoutExerciseCard to accordion-style collapsible layout per mockup design.

Purpose: Achieve ~70% space savings in collapsed state while maintaining full functionality in expanded state.
Output: Accordion-style WorkoutExerciseCard with progress ring, collapsed/expanded states, and timer only visible when expanded.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@mockups/workout-card-compact-option3.html

**Current implementation:**
@apps/web/src/surfaces/workout/WorkoutExerciseCard.tsx
@apps/web/src/surfaces/workout/SetRow.tsx
@apps/web/src/surfaces/workout/RestTimerBar.tsx
@apps/web/css/styles.css

**Design requirements from mockup:**
- Collapsed state: Progress ring + exercise name + Add Set button + remove button + chevron
- Expanded state: Set table + timer bar revealed on tap
- Remove category badge from header (per "Key Changes" in ROADMAP)
- Multiple cards can be expanded simultaneously
- All cards start collapsed
- Header tap toggles expand/collapse (except action buttons)
- Keep swipe-to-delete on set rows
- Timer only visible when expanded
- Progress ring shows completed/total sets with color change on complete
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add accordion state and progress ring to WorkoutExerciseCard</name>
  <files>apps/web/src/surfaces/workout/WorkoutExerciseCard.tsx</files>
  <action>
Refactor WorkoutExerciseCard to accordion pattern:

1. Add `isExpanded` state (useState, default false)
2. Add `toggleExpanded` handler that toggles state on header click (but not on action buttons)
3. Replace current header structure with new accordion header:
   - Progress ring SVG (40x40, radius 16, stroke-width 3) showing completedSets/totalSets
   - Calculate progress: completedSets = sets.filter(s => s.is_done).length, totalSets = sets.length
   - Progress ring stroke-dashoffset = circumference * (1 - completedSets/totalSets), circumference = 2 * PI * 16 â‰ˆ 100.53
   - Exercise name (no category badge per requirements)
   - Show "Complete" label in meta when all sets done
   - Header actions: Add Set button (green, compact), Remove button (shows on hover), Chevron (rotates 180deg when expanded)
4. Wrap set table + timer in collapsible body div with max-height transition
5. Action buttons (Add Set, Remove) should stopPropagation to prevent toggle
6. Keep all existing props and callbacks unchanged - this is a pure UI refactor

Use CSS classes for states: .exercise-workout-card.expanded, .card-header, .card-body, .progress-ring
  </action>
  <verify>npm run dev in apps/web, navigate to active workout, cards render in collapsed state with progress ring</verify>
  <done>WorkoutExerciseCard renders accordion layout with collapsed/expanded toggle, progress ring shows set completion</done>
</task>

<task type="auto">
  <name>Task 2: Add accordion CSS styles matching mockup design</name>
  <files>apps/web/css/styles.css</files>
  <action>
Add new CSS for accordion-style workout cards in the "Exercise Cards" section:

1. Card structure:
   - .exercise-workout-card: overflow hidden, border-radius 16px
   - .exercise-workout-card.expanded: accent border, subtle glow shadow

2. Header (.card-header):
   - display: flex, align-items: center, gap: 0.75rem, padding: 0.75rem
   - cursor: pointer, user-select: none
   - hover background: elevated color

3. Progress ring (.progress-ring):
   - 40x40 container, position relative
   - .progress-ring-bg: stroke bg-elevated, stroke-width 3
   - .progress-ring-fill: stroke accent, stroke-linecap round, transition stroke-dashoffset 0.5s
   - .progress-ring-fill.complete: stroke success (green)
   - .progress-text: absolute centered, mono font, 0.625rem, bold

4. Exercise info (.exercise-info):
   - flex: 1, min-width: 0
   - .exercise-name: 0.9375rem, bold, nowrap/ellipsis
   - .exercise-meta .complete-label: success color

5. Header actions (.header-actions):
   - .btn-add-set: compact green button with + icon, hover fills solid green
   - .btn-remove: opacity 0, visible on header hover, danger color on hover
   - .chevron: rotates 180deg when .expanded

6. Collapsible body (.card-body):
   - max-height: 0, overflow: hidden, transition: max-height 0.3s ease
   - .expanded .card-body: max-height: 600px
   - .body-content: padding with border-top separator

7. Timer section (.timer-section):
   - margin-top, padding-top, border-top separator
   - Full-width layout from mockup

Remove old .exercise-header styles for workout cards (keep template editor styles).
  </action>
  <verify>Cards visually match mockup - collapsed shows progress ring + name + buttons, expanded reveals sets + timer with smooth animation</verify>
  <done>Accordion CSS complete, cards match mockup design with proper animations and states</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Accordion-style WorkoutExerciseCard with progress ring and collapse/expand</what-built>
  <how-to-verify>
    1. Run: cd apps/web && npm run dev
    2. Login and start a workout from a template
    3. Verify collapsed state:
       - Cards show progress ring (0/N), exercise name, Add Set button, chevron
       - No category badge visible
       - Remove button appears on hover
    4. Tap card header:
       - Card expands smoothly (max-height transition)
       - Chevron rotates 180deg
       - Set table and timer become visible
       - Border changes to accent color
    5. Verify interactions:
       - Add Set button works without toggling expand
       - Remove button works without toggling expand
       - Complete a set - progress ring updates (1/N), ring fills proportionally
       - Complete all sets - ring turns green, "Complete" label appears
       - Swipe-to-delete still works on set rows
       - Timer controls work normally
    6. Multiple cards:
       - Expand multiple cards - all stay expanded (independent state)
       - Cards start collapsed when workout opens
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Cards render in collapsed state by default
- [ ] Progress ring shows correct completed/total count
- [ ] Expand/collapse animation is smooth
- [ ] All button interactions preserved
- [ ] Swipe-to-delete still functional
- [ ] Timer only visible when expanded
- [ ] No TypeScript errors (`tsc --noEmit`)
- [ ] No visual regressions on other surfaces
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Accordion UI matches mockup design
- ~70% vertical space savings in collapsed state
- Phase 31 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/31-exercise-card-accordion/31-01-SUMMARY.md`
</output>
