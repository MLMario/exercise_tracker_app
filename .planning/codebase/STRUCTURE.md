# Codebase Structure

**Analysis Date:** 2026-02-09

## Directory Layout

```
exercise_tracker_app/
├── apps/
│   ├── ios/                    # iOS React Native app (in development)
│   │   ├── src/                # TypeScript source files
│   │   └── package.json        # Workspace package definition
│   │
│   └── web/                    # Main Preact web application
│       ├── src/
│       │   ├── main.tsx        # Root App component, surface routing
│       │   ├── surfaces/       # Major UI sections (Auth, Dashboard, etc)
│       │   ├── components/     # Reusable modal components
│       │   ├── hooks/          # Web-specific custom hooks
│       │   ├── test-utils/     # Testing utilities for performance tests
│       │   └── env.d.ts        # Vite environment type definitions
│       ├── css/                # Global stylesheets (copied to dist during build)
│       ├── assets/             # Public static assets (index.html, favicon, etc)
│       ├── dist/               # Built output (generated by Vite)
│       ├── vite.config.ts      # Vite build configuration
│       ├── vitest.config.ts    # Vitest testing configuration
│       ├── vitest.setup.ts     # Test setup file
│       └── package.json
│
├── packages/
│   └── shared/                 # Shared types, services, hooks for web + iOS
│       ├── src/
│       │   ├── index.ts        # Barrel export of types, services, hooks
│       │   ├── types/          # Type definitions
│       │   │   ├── database.ts # Database entity types (Exercise, Template, etc)
│       │   │   ├── services.ts # Service return types (ServiceResult, AuthResult)
│       │   │   └── index.ts    # Barrel export
│       │   │
│       │   ├── services/       # Business logic modules
│       │   │   ├── auth.ts     # User authentication operations
│       │   │   ├── exercises.ts # Exercise library management
│       │   │   ├── templates.ts # Workout template CRUD
│       │   │   ├── charts.ts   # Chart configuration and data
│       │   │   ├── logging.ts  # Structured logging
│       │   │   └── index.ts    # Barrel export
│       │   │
│       │   ├── hooks/          # Shared custom hooks
│       │   │   ├── useConfirmationModal.ts
│       │   │   ├── useTimerState.ts
│       │   │   ├── useWorkoutBackup.ts
│       │   │   └── index.ts
│       │   │
│       │   ├── lib/            # Configuration and utilities
│       │   │   └── supabase.ts # Supabase client initialization
│       │   │
│       │   └── test-utils/     # Testing utilities (exported publicly)
│       │       ├── index.ts
│       │       └── performance.ts
│       │
│       ├── package.json        # Workspace package with peer deps
│       └── tsconfig.json       # TypeScript config
│
├── scripts/                    # Development utility scripts
│   ├── import-exercises.ts     # One-time exercise data import
│   └── testing/
│
├── sql/                        # Database schema and migrations
│
├── docs/                       # Documentation (separate from code docs)
│
├── screenshots/                # UI screenshots and design references
│
├── .planning/                  # GSD planning documents
│   └── codebase/              # Architecture, structure, conventions analysis
│
├── package.json               # Root workspace configuration
├── tsconfig.json              # Root TypeScript configuration
├── pnpm-workspace.yaml        # Workspace definition
└── README.md
```

## Directory Purposes

**apps/web/src/surfaces/:**
- Purpose: Major UI sections/pages that manage their own state
- Contains: Four surface components and their child components
- Key files: `AuthSurface.tsx`, `DashboardSurface.tsx`, `TemplateEditorSurface.tsx`, `WorkoutSurface.tsx`
- Subdirectories: `auth/`, `dashboard/`, `template-editor/`, `workout/` each contain surface + children
- Each surface exports via `index.ts` barrel file

**apps/web/src/surfaces/auth/:**
- Purpose: User authentication UI (login, register, password recovery)
- Key files: `AuthSurface.tsx` (surface wrapper), `LoginForm.tsx`, `RegisterForm.tsx`, `ResetPasswordForm.tsx`, `UpdatePasswordForm.tsx`
- State: AuthSubSurface type ('login' | 'register' | 'reset' | 'update'), form fields, loading states

**apps/web/src/surfaces/dashboard/:**
- Purpose: Main app interface after login - templates, charts, exercises
- Key files: `DashboardSurface.tsx` (container), `TemplateList.tsx`, `TemplateCard.tsx`, `ChartSection.tsx`, `ChartCard.tsx`, `MyExercisesList.tsx`, `AddChartModal.tsx`, `SettingsPanel.tsx`
- Contains: `__tests__/` directory with performance baselines (DashboardSurface.perf.test.tsx, SettingsPanel.perf.test.tsx)
- State: Templates list, charts list, available exercises, selected chart/template for modals

**apps/web/src/surfaces/template-editor/:**
- Purpose: Create/edit workout templates
- Key files: `TemplateEditorSurface.tsx` (surface), `ExerciseList.tsx`, `ExerciseEditor.tsx`
- State: Editing template data (exercises, set defaults, ordering)

**apps/web/src/surfaces/workout/:**
- Purpose: Active workout execution UI
- Key files: `WorkoutSurface.tsx` (surface), `WorkoutExerciseCard.tsx`, `SetRow.tsx`, `RestTimerBar.tsx`
- Contains: `__tests__/WorkoutSurface.perf.test.tsx` performance baseline
- State: Current exercise, completed sets, rest timer, workout progress tracking

**apps/web/src/components/:**
- Purpose: Reusable modal and dialog components used across surfaces
- Key files: `ConfirmationModal.tsx`, `ExercisePickerModal.tsx`, `InfoModal.tsx`
- Pattern: Presentational components that accept isOpen, onConfirm/onCancel callbacks

**apps/web/src/hooks/:**
- Purpose: Web-app-specific stateful hooks not in shared package
- Key files: `useAsyncOperation.ts` (async operation + error/success state), `useClickOutside.ts` (dismiss on outside click)
- Usage: Called by surfaces and components for state management

**packages/shared/src/services/:**
- Purpose: All business logic and external API integration
- Key files:
  - `auth.ts`: register, login, logout, resetPassword, updateUser, getCurrentUser, getSession, onAuthStateChange
  - `exercises.ts`: getExercises, createExercise, deleteExercise, searchExercises
  - `templates.ts`: getTemplates, createTemplate, updateTemplate, deleteTemplate, addExerciseToTemplate
  - `charts.ts`: getUserCharts, createChart, deleteChart, getChartData
  - `logging.ts`: log, error, info functions
- All modules follow service pattern: exported object with method functions returning ServiceResult types

**packages/shared/src/types/database.ts:**
- Purpose: TypeScript definitions for all database entities
- Contains:
  - Exercise (id, user_id, name, category, equipment, instructions, level, force, mechanic, is_system)
  - Template (id, user_id, name, created_at, updated_at)
  - TemplateExercise (id, template_id, exercise_id, default_rest_seconds, order)
  - TemplateExerciseSet (template_exercise_id, set_number, weight, reps)
  - TemplateWithExercises (composite type with nested exercises and sets)
  - WorkoutLog, WorkoutLogExercise, WorkoutLogSet (workout history records)
  - ExerciseCategory union type
- Used by: All service modules, all component props

**packages/shared/src/lib/supabase.ts:**
- Purpose: Typed Supabase client initialization
- Contains: Client creation with environment variable validation
- Environment variables required: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`
- Used by: All service modules for database and auth operations

**apps/web/css/:**
- Purpose: Global stylesheet files
- Pattern: CSS files are copied to root of dist/ during build via vite-plugin-static-copy
- Usage: Imported in index.html via `<link rel="stylesheet" href="/style.css">`

**apps/web/assets/:**
- Purpose: Public static files served at root of site
- Contains: index.html (React entry point), favicon, images
- Pattern: Vite uses this as publicDir, all files copied to dist root

## Key File Locations

**Entry Points:**
- `apps/web/src/main.tsx`: Preact render entry point, App component with surface routing
- `apps/web/assets/index.html`: HTML entry point for browser, mounts #app div
- `packages/shared/src/index.ts`: Shared package barrel export for types/services/hooks

**Configuration:**
- `apps/web/vite.config.ts`: Vite build config, path aliases, Preact plugin setup
- `apps/web/vitest.config.ts`: Test runner config, jsdom environment, test file patterns
- `apps/web/tsconfig.json`: TypeScript config, extends root, defines @/* alias
- `apps/web/package.json`: Web app dependencies and scripts
- `packages/shared/package.json`: Shared package dependencies (peers: @supabase, preact, chart.js)
- `pnpm-workspace.yaml`: Workspace definition for pnpm monorepo
- `.env`: Environment variables (not committed, contains VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY)

**Core Logic:**
- `packages/shared/src/services/auth.ts`: User authentication implementation
- `packages/shared/src/services/templates.ts`: Workout template operations
- `packages/shared/src/services/exercises.ts`: Exercise library operations
- `apps/web/src/main.tsx` (lines 99-327): App component with all surface state management

**Testing:**
- `apps/web/vitest.setup.ts`: Vitest setup file (DOM environment initialization)
- `apps/web/src/surfaces/dashboard/__tests__/DashboardSurface.perf.test.tsx`: Performance baseline for dashboard
- `apps/web/src/surfaces/workout/__tests__/WorkoutSurface.perf.test.tsx`: Performance baseline for workout
- `apps/web/src/test-utils/performance.test.ts`: Shared performance testing utilities

## Naming Conventions

**Files:**
- Surface components: `{SurfaceName}Surface.tsx` (e.g., AuthSurface.tsx, DashboardSurface.tsx)
- Child components: `{ComponentName}.tsx` in camelCase (e.g., TemplateList.tsx, ChartCard.tsx)
- Modals: `{Name}Modal.tsx` (e.g., ConfirmationModal.tsx, ExercisePickerModal.tsx)
- Services: `{domain}.ts` in camelCase (e.g., auth.ts, exercises.ts, templates.ts)
- Types: `{domain}.ts` for grouped types (e.g., database.ts, services.ts)
- Hooks: `use{HookName}.ts` in camelCase (e.g., useAsyncOperation.ts, useClickOutside.ts)
- Tests: `{component}.{test|spec}.{ts|tsx}` or `__tests__/{component}.perf.test.tsx`

**Directories:**
- Surfaces: `{surface-name}/` in kebab-case (auth, dashboard, template-editor, workout)
- Feature groups: `{feature}/` in kebab-case (components, hooks, services, types)
- Tests: `__tests__/` at same level as code being tested
- Build output: `dist/` (generated)

**Functions:**
- Components: PascalCase (e.g., `function AuthSurface()`, `function ConfirmationModal()`)
- Service functions: camelCase (e.g., `async function login()`, `async function getTemplates()`)
- Hooks: camelCase with `use` prefix (e.g., `function useAsyncOperation()`)

**Variables:**
- State variables: camelCase (e.g., `const [isLoading, setIsLoading] = useState()`)
- Constants: UPPER_SNAKE_CASE for immutable constants (rare in this codebase)

**Types:**
- Interfaces: PascalCase (e.g., `interface DashboardSurfaceProps`, `interface Exercise`)
- Union/literal types: camelCase descriptive (e.g., `type AppSurface`, `type EditingTemplateState`)
- Type imports: `import type { Exercise } from '@ironlift/shared'`

## Where to Add New Code

**New Feature (e.g., new domain like "goals"):**
- Create service: `packages/shared/src/services/goals.ts` following auth.ts pattern
- Create types: Add to `packages/shared/src/types/database.ts` or new file if large
- Export service: Add to `packages/shared/src/services/index.ts` barrel
- Create surface or extend existing: `apps/web/src/surfaces/{feature}/`
- Wire into App routing: Add surface state and case to main.tsx

**New Component (modal, card, list):**
- If shared across surfaces: `apps/web/src/components/{ComponentName}.tsx`
- If specific to surface: `apps/web/src/surfaces/{surface}/{ComponentName}.tsx`
- Create props interface: `interface {ComponentName}Props extends HTMLAttributes<HTMLDivElement>`
- Export from barrel: Add to surface or component `index.ts`

**New Hook:**
- If web-specific: `apps/web/src/hooks/use{HookName}.ts`
- If shared with iOS: `packages/shared/src/hooks/use{HookName}.ts`
- Export from barrel: Add to `hooks/index.ts`
- Document return type and usage in JSDoc

**New Service Operation:**
- Add function to appropriate service module in `packages/shared/src/services/`
- Return ServiceResult<T>, AuthResult, or SuccessResult (never throw)
- Add comprehensive JSDoc with params and return type
- Add error handling: try-catch with explicit error return
- Input validation before Supabase calls
- Export from service object at end of file
- Update barrel export in `services/index.ts` if new module

**Database Schema Change:**
- Add/modify SQL in `sql/` directory
- Update types in `packages/shared/src/types/database.ts`
- Test queries in service modules
- Document in schema comments

## Special Directories

**dist/:**
- Purpose: Built output generated by Vite
- Generated: Yes (created during `npm run build`)
- Committed: No (excluded in .gitignore)
- Contains: Bundled JavaScript, CSS from apps/web/css/, index.html from assets/

**node_modules/:**
- Purpose: Installed dependencies
- Generated: Yes (created by pnpm install)
- Committed: No (excluded in .gitignore)
- Note: Root level and per workspace

**.planning/codebase/:**
- Purpose: GSD codebase analysis documents
- Generated: Yes (by GSD mapping tools)
- Committed: Yes (tracked in git)
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md, STACK.md, INTEGRATIONS.md

**sql/:**
- Purpose: Database schema definitions and migrations
- Generated: No (manually maintained)
- Committed: Yes
- Contains: SQL files for Supabase database setup

**scripts/:**
- Purpose: Development utility scripts (data import, testing, etc)
- Generated: No (manually maintained)
- Committed: Yes
- Contains: import-exercises.ts and other one-time utilities

**.vscode/ and .claude/:**
- Purpose: IDE and Claude editor configuration
- Generated: No (manually maintained)
- Committed: Yes
- Contains: VSCode launch configs, Claude settings

---

*Structure analysis: 2026-02-09*
