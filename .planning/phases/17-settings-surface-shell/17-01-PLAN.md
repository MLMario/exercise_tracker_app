---
phase: 17-settings-surface-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/surfaces/dashboard/SettingsPanel.tsx
  - apps/web/src/surfaces/dashboard/SettingsMenu.tsx
  - apps/web/src/surfaces/dashboard/DashboardSurface.tsx
  - apps/web/src/surfaces/dashboard/index.ts
  - apps/web/css/styles.css
autonomous: true

must_haves:
  truths:
    - "User can tap gear icon in dashboard header (far right) to open Settings panel"
    - "Settings panel slides in from the right with darkened backdrop behind"
    - "Settings menu shows My Exercises as a tappable card-style item with icon and chevron"
    - "Settings menu shows a Log Out button with red text and outlined style"
    - "Tapping My Exercises navigates within the panel (replaces menu content with placeholder)"
    - "Back arrow returns from My Exercises sub-view to the Settings menu"
    - "Back arrow from Settings menu closes the panel"
    - "Tapping the darkened backdrop closes the panel"
    - "Logout button no longer appears in dashboard header"
    - "Panel resets to menu view when closed and reopened"
  artifacts:
    - path: "apps/web/src/surfaces/dashboard/SettingsPanel.tsx"
      provides: "Slide-in panel with backdrop, header, back navigation, and panelView state"
      exports: ["SettingsPanel"]
    - path: "apps/web/src/surfaces/dashboard/SettingsMenu.tsx"
      provides: "Menu view with My Exercises item and Log Out button"
      exports: ["SettingsMenu"]
    - path: "apps/web/src/surfaces/dashboard/DashboardSurface.tsx"
      provides: "Gear icon button replacing logout, renders SettingsPanel"
    - path: "apps/web/css/styles.css"
      provides: "CSS for settings-btn, settings-backdrop, settings-panel, settings-menu-item, settings-logout-btn"
  key_links:
    - from: "DashboardSurface.tsx"
      to: "SettingsPanel.tsx"
      via: "settingsOpen state and onClose/onLogout props"
      pattern: "settingsOpen.*SettingsPanel"
    - from: "SettingsPanel.tsx"
      to: "SettingsMenu.tsx"
      via: "panelView state conditional rendering"
      pattern: "panelView.*menu.*SettingsMenu"
    - from: "DashboardSurface.tsx"
      to: "onLogout prop"
      via: "passed through to SettingsPanel instead of direct button"
      pattern: "onLogout.*SettingsPanel"
---

<objective>
Create the Settings surface shell: a slide-in panel from the right side of the dashboard with a gear icon trigger, Settings menu (My Exercises item + Log Out button), internal sub-navigation, and backdrop overlay.

Purpose: Establishes the Settings surface that all subsequent exercise management phases (18-21) build into. Relocates logout from dashboard header to settings menu.
Output: SettingsPanel.tsx, SettingsMenu.tsx, modified DashboardSurface.tsx with gear icon, and CSS styles.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-settings-surface-shell/17-CONTEXT.md
@.planning/phases/17-settings-surface-shell/17-RESEARCH.md
@apps/web/src/surfaces/dashboard/DashboardSurface.tsx
@apps/web/src/surfaces/dashboard/index.ts
@apps/web/css/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SettingsPanel and SettingsMenu components</name>
  <files>
    apps/web/src/surfaces/dashboard/SettingsPanel.tsx
    apps/web/src/surfaces/dashboard/SettingsMenu.tsx
  </files>
  <action>
Create two new component files in the dashboard surface directory.

**SettingsMenu.tsx:**
- Props: `onMyExercises: () => void` and `onLogout?: () => void`
- Render a `div.settings-menu` containing:
  1. A `div.settings-menu-item` (clickable, calls onMyExercises) with:
     - Icon container (`div.settings-menu-item-icon`) with a list SVG (3 horizontal lines with dots: `<path d="M6 5h12M6 12h12M6 19h12">` + 3 small circles at x=3, y=5/12/19)
     - Content area (`div.settings-menu-item-content`) with label "My Exercises"
     - Chevron (`div.settings-menu-item-chevron`) with right-arrow SVG (`<path d="M9 18l6-6-6-6">`)
  2. A `button.settings-logout-btn` (conditionally rendered when onLogout exists) with text "Log Out", calls onLogout on click, type="button"
- SVG specs: list icon 20x20 viewBox 0 0 24 24, chevron 16x16 viewBox 0 0 24 24, both fill="none" stroke="currentColor" stroke-width="2"

**SettingsPanel.tsx:**
- Props: `isOpen: boolean`, `onClose: () => void`, `onLogout?: () => void`
- Internal state: `panelView` of type `'menu' | 'exercises'` (default 'menu')
- Import and render SettingsMenu component
- Structure:
  1. `div.settings-backdrop` (with `.open` class when isOpen is true) -- onClick calls onClose
  2. `div.settings-panel` (with `.open` class when isOpen is true) containing:
     a. `div.settings-panel-header` with:
        - `button.settings-back-btn` with back arrow SVG (`<path d="M19 12H5M12 19l-7-7 7-7">`, 20x20, viewBox 0 0 24 24) + text label
        - Back button text: "Back" when panelView is 'menu', "Settings" when panelView is 'exercises'
        - `span.settings-header-title` showing "Settings" or "My Exercises" based on panelView
     b. `div.settings-panel-content` with:
        - When panelView is 'menu': render `<SettingsMenu onMyExercises={() => setPanelView('exercises')} onLogout={onLogout} />`
        - When panelView is 'exercises': render `<div class="my-exercises-placeholder">My Exercises content coming soon</div>` (placeholder for Phase 18)
- Back button logic (handleBack):
  - If panelView is 'exercises': set panelView to 'menu'
  - If panelView is 'menu': call onClose()
- Reset logic: useEffect watching isOpen -- when isOpen becomes false, use setTimeout(250ms) to reset panelView to 'menu' after close animation finishes. Clean up timer on unmount.
- Backdrop click: calls onClose() directly (always closes panel fully, does NOT navigate back within panel)
- IMPORTANT: Always render both backdrop and panel in DOM (do NOT conditionally render with `{isOpen && ...}`). Visibility is controlled via CSS `.open` class for smooth enter/exit animations.
  </action>
  <verify>
Run `npx tsc --noEmit` from apps/web -- no TypeScript errors.
Confirm both files exist with correct exports.
  </verify>
  <done>
SettingsPanel.tsx exports SettingsPanel component with isOpen/onClose/onLogout props and internal panelView navigation.
SettingsMenu.tsx exports SettingsMenu component with My Exercises card item and Log Out button.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS, wire into DashboardSurface, update exports</name>
  <files>
    apps/web/css/styles.css
    apps/web/src/surfaces/dashboard/DashboardSurface.tsx
    apps/web/src/surfaces/dashboard/index.ts
  </files>
  <action>
**styles.css -- append settings panel CSS at the end of the file (before any closing comments):**

Add these CSS rules (reference: 17-RESEARCH.md "CSS for Settings Panel" section):

1. `.settings-btn` -- gear icon button: flex center, no background/border, color var(--color-text-secondary), padding var(--spacing-sm), border-radius var(--radius-sm), transition var(--transition-fast), min-height 36px, min-width 36px, cursor pointer
2. `.settings-btn:hover` -- background var(--color-bg-elevated), color var(--color-text-primary)
3. `.settings-backdrop` -- position fixed, inset 0, background rgba(0,0,0,0.7), z-index 1000, opacity 0, pointer-events none, transition opacity var(--transition-normal)
4. `.settings-backdrop.open` -- opacity 1, pointer-events auto
5. `.settings-panel` -- position fixed, top/right/bottom 0, width 80%, max-width 400px, background var(--color-bg-surface), border-left 1px solid var(--color-border), z-index 1001, transform translateX(100%), transition transform var(--transition-normal), display flex, flex-direction column, box-shadow var(--shadow-lg)
6. `.settings-panel.open` -- transform translateX(0)
7. `.settings-panel-header` -- padding var(--spacing-md) var(--spacing-lg), border-bottom 1px solid var(--color-border), display flex, align-items center
8. `.settings-header-left` -- display flex, align-items center, gap var(--spacing-md)
9. `.settings-back-btn` -- no background/border, color var(--color-accent), font-size 1rem, cursor pointer, display flex, align-items center, gap var(--spacing-xs), padding var(--spacing-sm), negative margin calc(-1 * var(--spacing-sm)), border-radius var(--radius-sm), transition background var(--transition-fast), min-height var(--min-tap-target), min-width var(--min-tap-target), font-family inherit
10. `.settings-back-btn:hover` -- background rgba(79, 158, 255, 0.1)
11. `.settings-header-title` -- font-size 1.25rem, font-weight 600
12. `.settings-panel-content` -- flex 1, overflow-y auto, padding var(--spacing-lg)
13. `.settings-menu-item` -- flex, align-items center, gap var(--spacing-md), padding var(--spacing-md), background var(--color-bg-elevated), border 1px solid var(--color-border), border-radius var(--radius-md), cursor pointer, transition all var(--transition-fast), margin-bottom var(--spacing-sm)
14. `.settings-menu-item:hover` -- border-color #3a3a3a
15. `.settings-menu-item-icon` -- 36x36px, flex center, background var(--color-bg-surface), border-radius var(--radius-md), flex-shrink 0, color var(--color-text-secondary)
16. `.settings-menu-item-content` -- flex 1
17. `.settings-menu-item-label` -- font-size 0.9375rem, font-weight 500, color var(--color-text-primary)
18. `.settings-menu-item-chevron` -- color var(--color-text-muted), display flex, align-items center
19. `.settings-logout-btn` -- no background, border 1px solid var(--color-border), color var(--color-danger), padding var(--spacing-md), border-radius var(--radius-md), font-size 0.9375rem, font-weight 500, cursor pointer, width 100%, margin-top var(--spacing-md), transition all var(--transition-fast), min-height var(--min-tap-target), font-family inherit
20. `.settings-logout-btn:hover` -- background rgba(248, 113, 113, 0.1), border-color var(--color-danger)

**DashboardSurface.tsx modifications:**

1. Add import: `import { SettingsPanel } from './SettingsPanel';`
2. Add state: `const [settingsOpen, setSettingsOpen] = useState(false);`
3. Replace the logout button block (lines 443-451, the `{onLogout && (<button class="logout-btn" ...>Logout</button>)}` block) with a gear icon button:
   ```
   <button class="settings-btn" onClick={() => setSettingsOpen(true)} type="button" aria-label="Settings">
     <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
       <circle cx="12" cy="12" r="3"></circle>
       <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
     </svg>
   </button>
   ```
   Note: The gear icon is always visible (no conditional on onLogout). The gear icon opens settings regardless of whether logout is available.
4. Add SettingsPanel at the end of the component return, just before the closing `</div>` of dashboard-surface-container (after the ConfirmationModal):
   ```
   <SettingsPanel
     isOpen={settingsOpen}
     onClose={() => setSettingsOpen(false)}
     onLogout={onLogout}
   />
   ```

**index.ts -- add SettingsPanel export:**
Add `export { SettingsPanel } from './SettingsPanel';` to the barrel file. Also export SettingsMenu: `export { SettingsMenu } from './SettingsMenu';`
  </action>
  <verify>
Run `npx tsc --noEmit` from apps/web -- no TypeScript errors.
Run `npm run build` from workspace root -- build succeeds.
Verify the old "logout-btn" text button no longer appears in DashboardSurface.tsx render output (search for "Logout" text in the JSX -- should only appear in SettingsMenu now).
  </verify>
  <done>
Gear icon button replaces logout button in dashboard header. SettingsPanel renders as an always-present overlay controlled by CSS classes. Settings menu contains My Exercises card item and Log Out button. CSS provides slide-from-right animation, backdrop overlay, and all menu/button styles. Build passes with zero errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes from apps/web (no type errors)
2. `npm run build` passes from workspace root (production build succeeds)
3. DashboardSurface.tsx no longer contains a `<button class="logout-btn">` element
4. DashboardSurface.tsx contains a `<button class="settings-btn">` with gear SVG
5. DashboardSurface.tsx renders `<SettingsPanel>` with isOpen, onClose, and onLogout props
6. SettingsPanel.tsx always renders backdrop + panel in DOM (no conditional `{isOpen && ...}` pattern)
7. SettingsPanel.tsx has panelView state with 'menu' | 'exercises' type and resets on close
8. SettingsMenu.tsx renders My Exercises card item and Log Out button
9. styles.css contains settings-backdrop, settings-panel, settings-btn, settings-menu-item, settings-logout-btn classes
</verification>

<success_criteria>
- Gear icon visible in dashboard header (far right, where logout used to be)
- Clicking gear icon opens settings panel (slide from right with backdrop)
- Settings menu shows "My Exercises" card item with list icon and chevron
- Settings menu shows "Log Out" outlined button with red text
- Clicking "My Exercises" switches panel content to exercises placeholder view
- Back arrow from exercises view returns to menu
- Back arrow from menu view closes panel
- Clicking backdrop closes panel
- Reopening panel always shows menu view (not stale exercises view)
- No logout button in dashboard header
- TypeScript compiles, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/17-settings-surface-shell/17-01-SUMMARY.md`
</output>
