---
phase: 11-integration
plan: 03
type: execute
depends_on: ["11-02"]
files_modified: [index.html]
---

<objective>
Migrate index.html from Alpine.js to Preact-only and clean up legacy code.

Purpose: Remove Alpine.js templates and code, making Preact the sole UI framework.
Output: Clean index.html with just #app mount point and necessary scripts.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-integration/11-01-SUMMARY.md
@.planning/phases/11-integration/11-02-SUMMARY.md
@index.html
@vite.config.ts

**Current state:**
- index.html has 927 lines (mostly Alpine.js templates)
- Scripts loaded: Supabase CDN, Alpine CDN, Chart.js CDN, js/config.local.js through js/app.js, src/main.tsx
- Both Alpine and Preact apps run simultaneously

**What to keep:**
- Supabase CDN (required for supabase client)
- Chart.js CDN (required for charts rendering)
- js/config.local.js (Supabase credentials)
- js/supabase.js (creates window.supabaseClient)
- js/auth.js through js/charts.js (service modules used by Preact via window.*)
- src/main.tsx (Vite entry point)

**What to remove:**
- Alpine.js CDN
- js/app.js (Alpine component - move to legacy)
- All Alpine template markup (x-data, x-show, @click, etc.)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create minimal index.html with #app mount</name>
  <files>index.html</files>
  <action>
Replace the entire index.html with a minimal version:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitTrack - Personal Fitness Tracker</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Preact app mount point -->
  <div id="app"></div>

  <!-- External Dependencies (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Local Configuration (gitignored) -->
  <script src="js/config.local.js"></script>

  <!-- Supabase Client Initialization -->
  <script src="js/supabase.js"></script>

  <!-- Service Modules (used by Preact surfaces via window.*) -->
  <script src="js/auth.js"></script>
  <script src="js/exercises.js"></script>
  <script src="js/templates.js"></script>
  <script src="js/logging.js"></script>
  <script src="js/timer.js"></script>
  <script src="js/charts.js"></script>

  <!-- Vite Entry Point (must be last, type=module) -->
  <script type="module" src="/src/main.tsx"></script>
</body>
</html>
```

Key changes:
- Remove Alpine.js CDN (no longer needed)
- Remove js/app.js script tag (Alpine component no longer loaded)
- Remove all Alpine template markup (927 lines -> ~30 lines)
- Keep #app div for Preact mount
- Keep all service scripts (they provide window.auth, window.exercises, etc.)
- Keep CDNs for Supabase and Chart.js
  </action>
  <verify>npm run dev starts without errors, page loads with Preact app</verify>
  <done>index.html is minimal with only #app mount and necessary scripts</done>
</task>

<task type="auto">
  <name>Task 2: Archive js/app.js to js/legacy/</name>
  <files>js/app.js</files>
  <action>
Move the old Alpine component to a legacy folder for reference:

```bash
mkdir -p js/legacy
mv js/app.js js/legacy/app.alpine.js
```

Add a comment at the top of the archived file:
```javascript
/**
 * ARCHIVED: Alpine.js Application Component
 *
 * This file contains the original Alpine.js implementation of the fitness app.
 * It has been replaced by Preact surfaces in src/surfaces/.
 *
 * Kept for reference during migration validation.
 * Can be deleted after confirming all functionality works in Preact.
 *
 * Archived: 2026-01-13
 */
```

This preserves the original code for reference while removing it from the active codebase.
  </action>
  <verify>js/app.js no longer exists at original location, js/legacy/app.alpine.js exists</verify>
  <done>Alpine component archived to js/legacy/ for reference</done>
</task>

<task type="auto">
  <name>Task 3: Verify full app functionality</name>
  <files>none (verification only)</files>
  <action>
Run through the complete app flow to verify everything works:

1. Start dev server: `npm run dev`
2. Open app in browser - should see auth surface
3. Register new user or log in
4. Verify dashboard loads with templates and charts
5. Create/edit/delete a template
6. Start a workout from a template
7. Add sets, complete workout, verify saved
8. Check charts updated after workout
9. Log out, verify returns to auth
10. Test password reset flow (if possible)

If any functionality is broken, the issue is likely:
- Missing service script (check console for undefined window.*)
- CSS not loading (check network tab)
- Preact component error (check console)

Run production build to verify:
```bash
npm run build
```
  </action>
  <verify>npm run build succeeds, all app functionality works in dev mode</verify>
  <done>Full app flow verified working with Preact-only implementation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run dev` starts and app loads
- [ ] Auth flow works (login, register, logout)
- [ ] Dashboard loads templates and charts
- [ ] Template editor works (create, edit, delete)
- [ ] Workout surface works (start, sets, finish, cancel)
- [ ] Charts update after completing workout
- [ ] No console errors related to Alpine.js
- [ ] Phase 11: Integration complete
</verification>

<success_criteria>
- index.html is minimal (~30 lines)
- Alpine.js completely removed from active code
- All app functionality works with Preact-only
- Legacy code archived for reference
- Phase 11 complete
</success_criteria>

<output>
After completion, create `.planning/phases/11-integration/11-03-SUMMARY.md` with:
- Full list of changes made
- Any issues encountered
- Final verification results
- Note that project refactor is complete
</output>
