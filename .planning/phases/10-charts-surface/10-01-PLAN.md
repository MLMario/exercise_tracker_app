---
phase: 10-charts-surface
plan: 01
type: execute
depends_on: []
files_modified: [src/services/charts.ts, src/services/index.ts]
---

<objective>
Migrate charts service from JavaScript to TypeScript with full type safety.

Purpose: Complete the service layer migration for charts CRUD and Chart.js rendering.
Output: TypeScript charts service with backward compatibility, added to barrel exports.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Source file to migrate:
@js/charts.js

# Type definitions already exist:
@src/types/services.ts (ChartsService interface at lines 621-687)

# Prior service migration pattern:
@.planning/phases/05-data-services/05-03-SUMMARY.md

# Established patterns:
- ServiceResult<T> pattern for consistent error handling
- String UUIDs and ISO timestamps matching Supabase JSON format
- window.* backward compatibility exports
- Barrel exports via src/services/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create charts service TypeScript module</name>
  <files>src/services/charts.ts</files>
  <action>
Migrate js/charts.js to TypeScript implementing the ChartsService interface from src/types/services.ts.

Implementation requirements:
1. Import supabaseClient from ./supabase
2. Import types: ServiceResult, ServiceError, UserChartData, CreateChartInput, RenderChartOptions, ChartData from @/types
3. Import Chart type from 'chart.js' for type safety

Functions to implement (matching ChartsService interface):
- getUserCharts(): Fetch user_charts with joined exercises data, ordered by 'order'
- createChart(chartData): Insert new chart with auto-calculated order value
- deleteChart(id): Delete chart by ID
- reorderCharts(chartIds): Update order values based on array position
- renderChart(canvasId, chartData, options): Create Chart.js line chart with dark theme styling
- destroyChart(chartInstance): Safely destroy Chart.js instance
- getMetricDisplayName(metricType): Map metric_type to display labels
- getModeDisplayName(mode): Map x_axis_mode to display labels

Key implementation notes:
- Use Chart.getChart(canvas) to check for existing instances before creating new ones
- Line chart with fill, tension 0.4, point styling, dark theme colors (#4f9eff, #2a2a2a, #ffffff)
- Responsive: true, maintainAspectRatio: false
- Y-axis beginAtZero: true

Add backward compatibility export at end:
```typescript
// Backward compatibility for legacy code
window.charts = charts;
```

Add window.charts type declaration for global augmentation.
  </action>
  <verify>npx tsc --noEmit passes with no errors</verify>
  <done>Charts service compiles, implements all ChartsService interface methods, has window.charts export</done>
</task>

<task type="auto">
  <name>Task 2: Add charts to barrel export</name>
  <files>src/services/index.ts</files>
  <action>
Add charts export to the services barrel file:
```typescript
export { charts } from './charts';
```

This follows the established pattern from auth, exercises, templates, and logging exports.
  </action>
  <verify>npm run build succeeds with no errors</verify>
  <done>Charts service exported from @/services, build passes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` succeeds
- [ ] All 8 ChartsService interface methods implemented
- [ ] Chart.js line chart renders with correct dark theme styling
- [ ] window.charts backward compatibility export present
- [ ] charts exported from src/services/index.ts barrel
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Charts service matches behavior of js/charts.js exactly
- Phase 10 complete - Charts Surface migrated
</success_criteria>

<output>
After completion, create `.planning/phases/10-charts-surface/10-01-SUMMARY.md`:

# Phase 10 Plan 01: Charts Service Migration Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/services/charts.ts` - Description
- `src/services/index.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for Phase 11 (Integration)
</output>
