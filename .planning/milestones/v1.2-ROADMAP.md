# Milestone v1.2: Legacy Code Cleanup

**Status:** SHIPPED 2026-01-14
**Phases:** 14-17
**Total Plans:** 5

## Overview

Remove all dependencies on legacy Alpine.js/window globals, enabling Preact components to use direct TypeScript imports. Final cleanup of legacy JavaScript files.

## Phases

### Phase 14: Workout Service Imports (Complete)

**Goal**: Update WorkoutSurface.tsx and TemplateEditorSurface.tsx to use direct service imports
**Depends on**: v1.1 complete
**Plans**: 1

Plans:
- [x] 14-01: Update WorkoutSurface + TemplateEditorSurface to use direct service imports

### Phase 15: Dashboard Service Imports (Complete)

**Goal**: Update DashboardSurface.tsx and ChartCard.tsx to use direct service imports
**Depends on**: Phase 14
**Plans**: 1

Plans:
- [x] 15-01: Update DashboardSurface + ChartCard to use direct service imports

### Phase 16: Remove Window Exports (Complete)

**Goal**: Remove window.* exports from all TypeScript services
**Depends on**: Phase 15
**Plans**: 1

Plans:
- [x] 16-01: Remove window exports from services and Window augmentation from env.d.ts

### Phase 17: Remove Legacy Files (Complete)

**Goal**: Delete js/*.js files, update index.html, remove window.supabaseClient export, remove JS from vite static-copy
**Depends on**: Phase 16
**Plans**: 2

Plans:
- [x] 17-01: Remove legacy JS references from HTML and build config
- [x] 17-02: Delete legacy JS files and remove window.supabaseClient export

---

## Milestone Summary

**Key Accomplishments:**
- All Preact surfaces now use direct ES module imports (no window.* globals)
- Removed 3,560 lines of legacy JavaScript code
- Deleted 8 legacy files (js/auth.js, js/exercises.js, js/templates.js, js/logging.js, js/charts.js, js/timer.js, js/supabase.js, js/legacy/app.alpine.js)
- Cleaned index.html of legacy script tags
- Removed JS from Vite static-copy config
- Fixed Chart.js v4 component registration issue

**Key Decisions:**
- Direct ES imports over window globals for better type safety and tree-shaking
- Keep js/config.local.js for user-specific configuration
- Explicit Chart.js component registration required for v4+

**Issues Resolved:**
- Chart.js "category scale not registered" error (required explicit component registration)

**Issues Deferred:**
None

**Technical Debt Incurred:**
None - this milestone specifically resolved technical debt

---

*For current project status, see .planning/ROADMAP.md*
