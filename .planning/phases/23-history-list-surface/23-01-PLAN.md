---
phase: 23-history-list-surface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/surfaces/dashboard/WorkoutHistoryList.tsx
  - apps/web/src/surfaces/dashboard/SettingsPanel.tsx
  - apps/web/css/styles.css
autonomous: true

must_haves:
  truths:
    - "User sees summary bar with workouts count, sets count, and volume (lbs)"
    - "User sees vertical timeline with date markers and dots"
    - "User sees compact workout cards with template name and badges"
    - "User sees badges showing exercise count, completed sets, total lbs"
    - "User sees last 7 workouts on initial load"
    - "User can click Load More to fetch additional workouts"
    - "User sees empty state when no workout history exists"
    - "User can navigate back from history list to settings menu"
  artifacts:
    - path: "apps/web/src/surfaces/dashboard/WorkoutHistoryList.tsx"
      provides: "History list component with timeline, cards, pagination"
      exports: ["WorkoutHistoryList"]
    - path: "apps/web/css/styles.css"
      provides: "Timeline and history card styles"
      contains: ".history-timeline"
  key_links:
    - from: "apps/web/src/surfaces/dashboard/SettingsPanel.tsx"
      to: "WorkoutHistoryList"
      via: "import and render in history view"
      pattern: "import.*WorkoutHistoryList"
    - from: "apps/web/src/surfaces/dashboard/WorkoutHistoryList.tsx"
      to: "@ironlift/shared logging service"
      via: "getWorkoutLogsPaginated, getWorkoutSummaryStats"
      pattern: "logging\\.getWorkout"
---

<objective>
Build the WorkoutHistoryList component that displays workout history as a browsable timeline with summary statistics, compact workout cards with badges, and Load More pagination.

Purpose: This is the main history browsing interface where users can see their past workouts at a glance before drilling into details (Phase 24).

Output:
- WorkoutHistoryList.tsx component
- Timeline and card CSS styles in styles.css
- SettingsPanel integration replacing placeholder
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-history-list-surface/23-RESEARCH.md
@.planning/phases/23-history-list-surface/23-CONTEXT.md
@.planning/mockups/mockup5-timeline-with-summary.html
@apps/web/src/surfaces/dashboard/MyExercisesList.tsx (pattern reference)
@apps/web/src/surfaces/dashboard/SettingsPanel.tsx
@packages/shared/src/types/services.ts (WorkoutHistoryItem, WorkoutSummaryStats, PaginatedResult)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkoutHistoryList component</name>
  <files>apps/web/src/surfaces/dashboard/WorkoutHistoryList.tsx</files>
  <action>
Create WorkoutHistoryList.tsx following the MyExercisesList pattern for self-contained list with internal state.

**State:**
- workouts: WorkoutHistoryItem[]
- summary: WorkoutSummaryStats | null
- isLoading: boolean (initial load)
- isLoadingMore: boolean (Load More)
- hasMore: boolean
- error: string

**Data fetching:**
- useEffect on mount: fetch summary and first page (7 items) in parallel using Promise.all
- loadMore function: fetch next page using workouts.length as offset, append with functional setState

**Render structure:**
1. Loading state: "Loading history..." centered text (reuse .my-exercises-loading pattern)
2. Error state: error message
3. Empty state (workouts.length === 0 AND !isLoading):
   - div.history-empty with p.history-empty-text "No workout history yet"
   - Do NOT show summary bar when empty
4. Content (when workouts exist):
   - Summary bar (div.history-summary) with 3 stat boxes:
     - Workouts count (summary.totalWorkouts)
     - Sets count (summary.totalSets)
     - Volume (formatVolume(summary.totalVolume) + " lbs")
   - Timeline container (div.history-timeline)
     - For each workout: div.history-timeline-item containing:
       - div.history-timeline-dot
       - div.history-timeline-date (formatWorkoutDate)
       - div.history-card (tappable, onClick placeholder for Phase 24)
         - div.history-card-header with template name (or "Quick Workout" if null)
         - div.history-card-badges with 3 badges:
           - Exercise count badge
           - Completed sets badge (success style)
           - Volume badge
   - Load More button (when hasMore): centered link-style button "Load More"
   - Loading indicator when isLoadingMore

**Utility functions (inline in component file):**
```typescript
function formatVolume(n: number): string {
  if (n >= 1000) {
    const k = n / 1000;
    return k % 1 === 0 ? k + 'k' : k.toFixed(1) + 'k';
  }
  return n.toLocaleString();
}

function formatWorkoutDate(isoString: string): string {
  const date = new Date(isoString);
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric'
  });
}
```

**Props:**
- onSelectWorkout?: (workoutId: string) => void (optional callback for Phase 24)

**Imports:**
```typescript
import { useState, useEffect } from 'preact/hooks';
import type { WorkoutHistoryItem, WorkoutSummaryStats } from '@ironlift/shared';
import { logging } from '@ironlift/shared';
```

**Stale closure prevention:** Use functional setState for loadMore:
```typescript
setWorkouts(prev => [...prev, ...newItems]);
```
  </action>
  <verify>
- File exists at apps/web/src/surfaces/dashboard/WorkoutHistoryList.tsx
- TypeScript compiles without errors: `cd apps/web && npx tsc --noEmit`
- Component exports WorkoutHistoryList function
  </verify>
  <done>
WorkoutHistoryList component created with:
- Summary bar rendering stats
- Timeline with date markers and dots
- Workout cards with badges
- Load More pagination
- Empty state handling
  </done>
</task>

<task type="auto">
  <name>Task 2: Add history timeline CSS styles</name>
  <files>apps/web/css/styles.css</files>
  <action>
Add CSS styles at the end of styles.css for the history timeline and cards. Extract from mockup5-timeline-with-summary.html, adapting to use existing CSS variables.

**Add these style blocks:**

```css
/* ==========================================================================
   History Timeline
   ========================================================================== */

.history-summary {
  display: flex;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-lg);
  border-bottom: 1px solid var(--color-border);
}

.history-summary-stat {
  flex: 1;
  text-align: center;
  padding: var(--spacing-sm);
  background: var(--color-bg-primary);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border-dim);
}

.history-summary-val {
  font-size: 1.125rem;
  font-weight: 700;
  font-family: var(--font-mono);
  color: var(--color-accent);
}

.history-summary-label {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--color-text-muted);
  margin-top: 2px;
}

.history-timeline {
  position: relative;
  padding-left: 28px;
}

.history-timeline::before {
  content: '';
  position: absolute;
  left: 6px;
  top: 8px;
  bottom: 8px;
  width: 2px;
  background: var(--color-border);
  border-radius: 1px;
}

.history-timeline-item {
  position: relative;
  margin-bottom: var(--spacing-md);
}

.history-timeline-dot {
  position: absolute;
  left: -28px;
  top: 14px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--color-bg-primary);
  border: 2px solid var(--color-accent);
  z-index: 1;
}

.history-timeline-date {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  margin-bottom: var(--spacing-xs);
  font-family: var(--font-mono);
  font-weight: 700;
  letter-spacing: 0.03em;
}

.history-card {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border-dim);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
  cursor: pointer;
  transition: border-color var(--transition-fast);
}

.history-card:hover {
  border-color: var(--color-border);
}

.history-card-header {
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: var(--spacing-sm);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.history-card-badges {
  display: flex;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
}

.history-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px var(--spacing-sm);
  background: rgba(79, 158, 255, 0.1);
  color: var(--color-accent);
  border-radius: var(--radius-full);
  font-size: 0.6875rem;
  font-weight: 600;
  font-family: var(--font-mono);
  white-space: nowrap;
}

.history-badge.success {
  background: rgba(74, 222, 128, 0.1);
  color: var(--color-success);
}

.history-empty {
  text-align: center;
  padding: var(--spacing-2xl) var(--spacing-md);
}

.history-empty-text {
  color: var(--color-text-muted);
  font-size: 1rem;
}

.history-load-more {
  display: block;
  width: 100%;
  padding: var(--spacing-md);
  background: none;
  border: none;
  color: var(--color-accent);
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  text-align: center;
  transition: opacity var(--transition-fast);
}

.history-load-more:hover {
  opacity: 0.8;
}

.history-load-more:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```
  </action>
  <verify>
- CSS added to end of styles.css
- No syntax errors (check browser dev tools after starting app)
- Variables reference existing CSS custom properties
  </verify>
  <done>
History timeline CSS styles added including:
- Summary bar layout
- Timeline with vertical line and dots
- Workout card styling
- Badge styles
- Empty state
- Load More button
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate WorkoutHistoryList into SettingsPanel</name>
  <files>apps/web/src/surfaces/dashboard/SettingsPanel.tsx</files>
  <action>
Replace the history placeholder in SettingsPanel with the WorkoutHistoryList component.

**Changes:**

1. Add import at top:
```typescript
import { WorkoutHistoryList } from './WorkoutHistoryList';
```

2. Replace the placeholder div (lines ~110-113) with:
```typescript
{panelView === 'history' && (
  <WorkoutHistoryList />
)}
```

Remove the inline styles and placeholder text entirely.

**Note:** The onSelectWorkout callback is optional and will be wired in Phase 24. For now, tapping cards will have no navigation effect (just visual hover feedback).
  </action>
  <verify>
- Import statement added
- Placeholder replaced with component
- TypeScript compiles: `cd apps/web && npx tsc --noEmit`
- App runs: `cd apps/web && npm run dev` then navigate to Settings > Workout History
  </verify>
  <done>
SettingsPanel now renders WorkoutHistoryList when panelView is 'history', replacing placeholder
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compilation:**
   ```bash
   cd apps/web && npx tsc --noEmit
   ```

2. **Visual verification:**
   - Start dev server: `cd apps/web && npm run dev`
   - Navigate to Settings > Workout History
   - Verify summary bar shows stats (or empty state if no workouts)
   - Verify timeline renders with date markers and dots
   - Verify workout cards show template name and badges
   - If more than 7 workouts exist, verify Load More appears and works

3. **Requirements coverage:**
   - HIST-01: Summary bar with workouts, sets, volume
   - HIST-02: Vertical timeline with date markers and dots
   - HIST-03: Compact workout cards with template name and date
   - HIST-04: Badges showing exercise count, sets, volume
   - HIST-05: Last 7 workouts on initial load
   - HIST-06: Load More button for pagination
   - HIST-07: Empty state when no history
   - NAV-03: Back navigation to settings (existing behavior)
</verification>

<success_criteria>
- WorkoutHistoryList component exists and renders
- Summary bar displays 3 stats (or hidden when empty)
- Timeline renders with vertical line and dots
- Workout cards show template name and 3 badges
- Load More works for pagination
- Empty state shown when no workouts
- Back button returns to settings menu (existing)
- No TypeScript errors
- No console errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-history-list-surface/23-01-SUMMARY.md`
</output>
