---
phase: 21-exercise-create
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/surfaces/dashboard/SettingsPanel.tsx
  - apps/web/src/surfaces/dashboard/MyExercisesList.tsx
autonomous: true

must_haves:
  truths:
    - "User can tap '+ Create' button in My Exercises header to open create modal"
    - "User can fill exercise name and select category, then tap 'Create Exercise' to create"
    - "Create button is disabled until both name and category are provided"
    - "After creating, the new exercise appears in the My Exercises list without manual refresh"
    - "User can tap 'Create Exercise' button in the empty state to open the same create modal"
    - "After creating from empty state, the list replaces the empty state"
  artifacts:
    - path: "apps/web/src/surfaces/dashboard/SettingsPanel.tsx"
      provides: "Header '+ Create' button conditional on exercises view, showCreateModal state lifted"
      contains: "showCreateModal"
    - path: "apps/web/src/surfaces/dashboard/MyExercisesList.tsx"
      provides: "Create exercise modal with name input, category dropdown, create/cancel buttons"
      contains: "Create Exercise"
  key_links:
    - from: "SettingsPanel.tsx header button"
      to: "MyExercisesList create modal"
      via: "showCreateModal prop passed from SettingsPanel to MyExercisesList"
      pattern: "showCreateModal"
    - from: "MyExercisesList empty state button"
      to: "MyExercisesList create modal"
      via: "onOpenCreate callback prop from SettingsPanel"
      pattern: "onOpenCreate"
    - from: "MyExercisesList create modal submit"
      to: "exercises.createExercise()"
      via: "handleCreate callback calling service"
      pattern: "exercises\\.createExercise"
    - from: "createExercise result"
      to: "userExercises state"
      via: "setUserExercises append + sort"
      pattern: "setUserExercises.*sort"
---

<objective>
Add exercise creation capability to the My Exercises management view. Users trigger creation via a header "+ Create" button (or the empty state CTA), fill out a simplified modal with name and category, and see the new exercise appear in the sorted list.

Purpose: Completes CRUD-01 -- the final requirement for v3.0 Settings & Exercise Management milestone.
Output: Modified SettingsPanel.tsx (header button + lifted state) and MyExercisesList.tsx (create modal + wiring).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-exercise-create/21-CONTEXT.md
@.planning/phases/21-exercise-create/21-RESEARCH.md
@apps/web/src/surfaces/dashboard/SettingsPanel.tsx
@apps/web/src/surfaces/dashboard/MyExercisesList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add "+ Create" button to SettingsPanel header and lift modal state</name>
  <files>apps/web/src/surfaces/dashboard/SettingsPanel.tsx</files>
  <action>
  Modify SettingsPanel to:

  1. Add `showCreateModal` state (`useState<boolean>(false)`) inside SettingsPanel.
  2. Add a handler `handleOpenCreate` that sets `showCreateModal` to true.
  3. Inside the `.settings-panel-header` div, AFTER the `.settings-header-left` div, add a conditional "+ Create" button that renders ONLY when `panelView === 'exercises'`:
     ```tsx
     {panelView === 'exercises' && (
       <button type="button" class="btn btn-primary btn-sm" onClick={handleOpenCreate}>
         + Create
       </button>
     )}
     ```
     This button will be pushed to the far right by adding `margin-left: auto` directly on the button (or via a style attribute), since `.settings-panel-header` is `display: flex; align-items: center` but has no `justify-content: space-between`.

  4. Pass two new props to MyExercisesList:
     - `showCreateModal={showCreateModal}`
     - `onOpenCreate={handleOpenCreate}` (for the empty state button to use)
     - `onCloseCreate={() => setShowCreateModal(false)}`

  5. Reset `showCreateModal` to false in the existing `useEffect` that resets panelView on close (add `setShowCreateModal(false)` alongside the `setPanelView('menu')` call inside the timer callback).

  Do NOT add `justify-content: space-between` to the header -- use `margin-left: auto` on the button to push it right without affecting existing layout.
  </action>
  <verify>TypeScript compilation passes with `npx tsc --noEmit` from the apps/web directory. The SettingsPanel renders a "+ Create" button in the header area when panelView is 'exercises', and passes showCreateModal/onOpenCreate/onCloseCreate props to MyExercisesList.</verify>
  <done>SettingsPanel header shows "+ Create" button (btn btn-primary btn-sm, right-aligned) only on exercises view. Modal open state is lifted to SettingsPanel and passed down as props.</done>
</task>

<task type="auto">
  <name>Task 2: Add create exercise modal to MyExercisesList with full wiring</name>
  <files>apps/web/src/surfaces/dashboard/MyExercisesList.tsx</files>
  <action>
  Modify MyExercisesList to accept and use the new create modal props:

  1. Update the component props interface to accept:
     ```tsx
     interface MyExercisesListProps {
       onExerciseDeleted?: () => void;
       showCreateModal?: boolean;
       onOpenCreate?: () => void;
       onCloseCreate?: () => void;
     }
     ```

  2. Add create-specific state:
     - `createName` (string, initially '')
     - `createCategory` (string, initially '' -- NOT a default category, per CONTEXT.md)
     - `createError` (string, initially '')
     - `isCreating` (boolean, initially false)

  3. Add `dismissCreate` callback: resets `createName` to '', `createCategory` to '', `createError` to '', and calls `onCloseCreate?.()`. Do NOT dismiss if `isCreating` is true.

  4. Add `handleCreate` callback:
     - Set `isCreating` to true, clear `createError`
     - Call `exercises.createExercise(createName.trim(), createCategory as ExerciseCategory)`
     - On success (`result.data`): update `setUserExercises(prev => [...prev, result.data!].sort((a, b) => a.name.localeCompare(b.name)))`, then call `dismissCreate()` (reset fields + close modal)
     - On error (`result.error`): set `createError` to `result.error.message` (this surfaces duplicate name errors like "An exercise with this name already exists")
     - Set `isCreating` to false

  5. Wire the empty state "Create Exercise" button:
     - In the empty state section (where `userExercises.length === 0`), add `onClick={onOpenCreate}` to the existing dead button on line 189.

  6. Add the create modal markup. Render it at the TOP level of the component return (inside the Fragment), visible when `showCreateModal` is true. Place it AFTER the list/empty-state content but BEFORE the delete modal, following the same structural pattern:
     ```tsx
     {showCreateModal && (
       <div class="modal-overlay" onClick={dismissCreate}>
         <div class="modal modal-sm" onClick={(e: JSX.TargetedMouseEvent<HTMLDivElement>) => e.stopPropagation()}>
           <div class="modal-header">
             <h2>Create Exercise</h2>
           </div>
           <div class="modal-body">
             <div class="form-group">
               <input
                 type="text"
                 placeholder="Exercise name"
                 value={createName}
                 onInput={(e: JSX.TargetedEvent<HTMLInputElement>) => setCreateName(e.currentTarget.value)}
                 disabled={isCreating}
               />
             </div>
             <div class="form-group">
               <select
                 value={createCategory}
                 onChange={(e: JSX.TargetedEvent<HTMLSelectElement>) => setCreateCategory(e.currentTarget.value)}
                 disabled={isCreating}
               >
                 <option value="">Select category</option>
                 {categories.map(cat => (
                   <option key={cat} value={cat}>{cat}</option>
                 ))}
               </select>
             </div>
             {createError && <div class="error-message">{createError}</div>}
           </div>
           <div class="modal-footer">
             <button type="button" class="btn btn-sm btn-secondary" onClick={dismissCreate} disabled={isCreating}>
               Cancel
             </button>
             <button
               type="button"
               class="btn btn-sm btn-primary"
               onClick={handleCreate}
               disabled={!createName.trim() || !createCategory || isCreating}
             >
               {isCreating ? 'Creating...' : 'Create Exercise'}
             </button>
           </div>
         </div>
       </div>
     )}
     ```

  7. The create modal must appear in BOTH render paths: the empty state return (line 182-220 area) AND the list return (line 227-333 area). Add it inside the Fragment in both locations.

  Important constraints from CONTEXT.md:
  - No default category -- placeholder "Select category" with value=""
  - Create button disabled until BOTH name is filled AND category is selected -- no inline error messages for validation
  - No success flash or toast after create -- modal closes, list updates, that is the confirmation
  - No auto-scroll to new exercise
  - New exercise appears collapsed (not expanded into edit mode)
  - Server errors (duplicate name, network failure) ARE shown as a general error in modal body
  - Do NOT close modal during active creation (isCreating === true)
  </action>
  <verify>
  1. TypeScript compilation passes: `npx tsc --noEmit` from apps/web directory
  2. Dev server builds without errors: `npm run dev` from monorepo root
  3. Manual verification: Navigate to Settings > My Exercises, confirm "+ Create" button visible in header, click it, modal opens with name input and category dropdown, Create Exercise button disabled until both filled, creating exercise closes modal and shows it in list
  </verify>
  <done>
  - Create modal opens from both header "+ Create" button and empty state "Create Exercise" button
  - Modal has name input (placeholder "Exercise name"), category dropdown (placeholder "Select category", no default)
  - "Create Exercise" button disabled until both fields filled
  - Successful create: modal closes, new exercise appears sorted in list
  - Duplicate name: error message shown in modal
  - Empty state transitions to list after first exercise created
  - No success flash, no auto-scroll, new exercise appears collapsed
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes from apps/web -- no type errors
2. Dev server starts and builds without errors
3. Navigate to Settings > My Exercises:
   - "+ Create" button visible in header (right-aligned, btn btn-primary btn-sm)
   - Click "+ Create" -- modal opens with "Create Exercise" title
   - Name input empty, category shows "Select category" placeholder
   - "Create Exercise" button is disabled
   - Fill name, select category -- "Create Exercise" button enables
   - Click "Create Exercise" -- modal closes, exercise appears in alphabetical position in list
4. When list is empty:
   - Empty state shows "Create Exercise" button
   - Click it -- same create modal opens
   - Create exercise -- empty state replaced by list with new exercise
5. Try creating duplicate name -- error message appears in modal
6. Click overlay while idle -- modal closes. Click overlay while creating -- modal stays open
7. "+ Create" button NOT visible on Settings menu view (only on exercises view)
</verification>

<success_criteria>
- CRUD-01 requirement satisfied: User can create a new exercise from My Exercises view
- "+ Create" header button matches TemplateList style (btn btn-primary btn-sm)
- Create modal is a simplified standalone modal (NOT the ExercisePickerModal)
- Empty state CTA wired to same modal
- List refreshes with new exercise sorted alphabetically
- No regressions to edit or delete functionality
</success_criteria>

<output>
After completion, create `.planning/phases/21-exercise-create/21-01-SUMMARY.md`
</output>
