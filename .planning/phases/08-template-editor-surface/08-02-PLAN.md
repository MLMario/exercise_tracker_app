---
phase: 08-template-editor-surface
plan: 02
type: execute
depends_on: ["08-01"]
files_modified: [src/surfaces/template-editor/ExerciseEditor.tsx, src/surfaces/template-editor/ExerciseList.tsx, src/surfaces/template-editor/TemplateEditorSurface.tsx]
---

<objective>
Create exercise editing components for template editor with set management and reordering.

Purpose: Build the UI for adding, editing, removing, and reordering exercises in a template.
Output: ExerciseEditor and ExerciseList components integrated into TemplateEditorSurface.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-template-editor-surface/08-01-SUMMARY.md

# Key reference files:
@src/surfaces/template-editor/TemplateEditorSurface.tsx
@index.html (lines 447-511 for exercise editor HTML)
@js/app.js (lines 613-655 for exercise manipulation methods)

**Tech stack available:** Preact, TypeScript
**Established patterns:** Presentational components with callback props
**Constraining decisions:**
- Phase 8-01: EditingExercise and EditingTemplate interfaces defined
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExerciseEditor component for single exercise</name>
  <files>src/surfaces/template-editor/ExerciseEditor.tsx</files>
  <action>
Create ExerciseEditor.tsx following TemplateCard presentational pattern:

1. Props interface (ExerciseEditorProps):
   - exercise: EditingExercise
   - index: number
   - isFirst: boolean (disable move up)
   - isLast: boolean (disable move down)
   - onMoveUp: () => void
   - onMoveDown: () => void
   - onRemove: () => void
   - onAddSet: () => void
   - onRemoveSet: (setIndex: number) => void
   - onUpdateSet: (setIndex: number, field: 'weight' | 'reps', value: number) => void
   - onUpdateRestTime: (seconds: number) => void

2. Render structure matching index.html lines 449-510:
   - Exercise header: name, category badge, move up/down buttons, remove button
   - Set table with header (Set, lbs, Reps, remove)
   - Set rows: set_number display, weight input, reps input, remove button (hidden if only 1 set)
   - Add Set button
   - Rest time row: label, number input, "seconds" suffix

Use controlled inputs - call onUpdateSet/onUpdateRestTime on change.
Number inputs: weight min=0 step=0.5, reps min=0, rest_time min=0.
  </action>
  <verify>npx tsc --noEmit passes, component renders set table correctly</verify>
  <done>ExerciseEditor renders exercise with sets, move/remove buttons, and rest time input</done>
</task>

<task type="auto">
  <name>Task 2: Create ExerciseList and integrate into TemplateEditorSurface</name>
  <files>src/surfaces/template-editor/ExerciseList.tsx, src/surfaces/template-editor/TemplateEditorSurface.tsx</files>
  <action>
1. Create ExerciseList.tsx:
   Props interface (ExerciseListProps):
   - exercises: EditingExercise[]
   - onAddExercise: () => void (opens picker)
   - onMoveUp: (index: number) => void
   - onMoveDown: (index: number) => void
   - onRemove: (index: number) => void
   - onAddSet: (exerciseIndex: number) => void
   - onRemoveSet: (exerciseIndex: number, setIndex: number) => void
   - onUpdateSet: (exerciseIndex: number, setIndex: number, field: 'weight' | 'reps', value: number) => void
   - onUpdateRestTime: (exerciseIndex: number, seconds: number) => void

   Render structure matching index.html lines 439-517:
   - Section header "Exercises" with "Add Exercise" button
   - Map exercises to ExerciseEditor components with key={exercise.exercise_id || index}
   - Pass isFirst/isLast based on index
   - Empty state when exercises.length === 0

2. Update TemplateEditorSurface.tsx:
   Add exercise manipulation methods matching js/app.js:
   - handleMoveExerciseUp(index) - lines 617-623
   - handleMoveExerciseDown(index) - lines 625-631
   - handleRemoveExercise(index) - line 613-615
   - handleAddSet(exerciseIndex) - lines 633-641
   - handleRemoveSet(exerciseIndex, setIndex) - lines 643-654
   - handleUpdateSet(exerciseIndex, setIndex, field, value) - update set property
   - handleUpdateRestTime(exerciseIndex, seconds) - update default_rest_seconds
   - handleOpenExercisePicker() - placeholder for Plan 03 (just console.log for now)

   Replace placeholder div with ExerciseList component, passing all handlers.
  </action>
  <verify>npm run build succeeds, exercises render with all controls functional</verify>
  <done>ExerciseList shows exercises, all manipulation handlers work (add/move/remove sets)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] ExerciseEditor.tsx renders single exercise with all controls
- [ ] ExerciseList.tsx renders list with header and empty state
- [ ] Move up/down reorders exercises correctly
- [ ] Add/remove set updates set array
- [ ] Set weight/reps inputs update state
- [ ] Rest time input updates default_rest_seconds
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Can edit exercises in template (except adding new - Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/08-template-editor-surface/08-02-SUMMARY.md`
</output>
