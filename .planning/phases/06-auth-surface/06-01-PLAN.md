---
phase: 06-auth-surface
plan: 01
type: execute
depends_on: []
files_modified: [package.json, vite.config.ts, src/surfaces/index.ts, src/surfaces/auth/index.tsx, src/surfaces/auth/AuthSurface.tsx, src/main.ts]
---

<objective>
Set up Preact with Vite and create the AuthSurface container component with state management.

Purpose: Establish Preact foundation and auth surface structure that all auth forms will integrate into.
Output: Working Preact setup, AuthSurface component with sub-surface routing and shared state.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-framework-evaluation/03-01-SUMMARY.md
@.planning/phases/04-auth-service/04-01-SUMMARY.md

**Tech stack available:** TypeScript, Vite, Supabase, auth service (src/services/auth.ts)
**Established patterns:** ESM modules, barrel exports, ServiceResult<T> pattern
**Constraining decisions:**
- Phase 3: Preact selected for React-compatible 4KB framework
- Phase 4: Auth service at src/services/auth.ts with backward compatibility

**Source reference for state/behavior:**
@js/app.js (lines 1-160) - Auth state variables and init
@index.html (lines 20-320) - Auth surface HTML structure
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Preact and configure Vite for JSX</name>
  <files>package.json, vite.config.ts</files>
  <action>
Install Preact dependencies:
- `preact` - Core framework
- `@preact/preset-vite` - Vite plugin for JSX/TSX support

Update vite.config.ts:
- Import and add preact() plugin
- Ensure path aliases work with JSX files (.tsx)

Verify TypeScript can handle JSX:
- tsconfig.json should have "jsx": "react-jsx" and "jsxImportSource": "preact"
- If not present, add these settings

Run: `npm install preact @preact/preset-vite`

Do NOT use full React - use Preact for 4KB bundle size per Phase 3 decision.
  </action>
  <verify>npm run build succeeds with no JSX-related errors</verify>
  <done>Preact installed, Vite configured for JSX, TypeScript compiles .tsx files</done>
</task>

<task type="auto">
  <name>Task 2: Create AuthSurface container with state and routing</name>
  <files>src/surfaces/index.ts, src/surfaces/auth/index.tsx, src/surfaces/auth/AuthSurface.tsx, src/main.ts</files>
  <action>
Create directory structure:
- src/surfaces/ (barrel export)
- src/surfaces/auth/ (auth surface module)

Create src/surfaces/auth/AuthSurface.tsx:
- Functional component using Preact hooks (useState)
- Port auth state from js/app.js lines 6-24:
  - authSurface: 'login' | 'register' | 'reset' | 'updatePassword'
  - authEmail, authPassword, authConfirmPassword (string)
  - authLoading (boolean)
  - showLoginPassword, showRegisterPassword, showConfirmPassword, showUpdatePassword, showUpdateConfirmPassword (boolean)
  - resetEmailSent, passwordUpdateSuccess (boolean)
  - isPasswordRecoveryMode (boolean)
  - error, successMessage (string)
- Create switchAuthSurface function to change sub-surface
- Create togglePasswordVisibility function (takes field name)
- Render placeholder for each sub-surface based on authSurface state
- Import auth service from '@/services/auth' for onAuthStateChange

Create src/surfaces/auth/index.tsx:
- Export AuthSurface as default

Create src/surfaces/index.ts:
- Barrel export: export { default as AuthSurface } from './auth'

Update src/main.ts:
- Import { render } from 'preact'
- Import AuthSurface from surfaces
- Render AuthSurface into #app element (add div#app to index.html if needed)
- Keep existing console.log for now

Structure mirrors existing Alpine pattern:
- currentSurface controls which main surface shows
- authSurface controls which auth sub-surface shows
  </action>
  <verify>npm run build succeeds, browser shows AuthSurface component renders (check console or DOM)</verify>
  <done>AuthSurface component exists with state management, renders placeholder content, exported via barrel</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Preact and @preact/preset-vite in package.json dependencies
- [ ] vite.config.ts includes preact() plugin
- [ ] src/surfaces/auth/AuthSurface.tsx exists with useState hooks
- [ ] AuthSurface has all 12+ state variables from Alpine version
- [ ] src/main.ts renders Preact component
</verification>

<success_criteria>

- Preact installed and configured
- AuthSurface container component created
- State management mirrors Alpine.js auth state
- Sub-surface routing structure in place
- Build passes, component renders
</success_criteria>

<output>
After completion, create `.planning/phases/06-auth-surface/06-01-SUMMARY.md`
</output>
