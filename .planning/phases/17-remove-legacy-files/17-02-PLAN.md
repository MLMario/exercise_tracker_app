---
phase: 17-remove-legacy-files
plan: 02
type: execute
depends_on: ["17-01"]
files_modified: [src/lib/supabase.ts, js/auth.js, js/exercises.js, js/templates.js, js/logging.js, js/charts.js, js/timer.js, js/supabase.js]
---

<objective>
Remove legacy supabase window export and delete all legacy JS files.

Purpose: Final cleanup - remove dead code and legacy files from the codebase.
Output: Clean src/lib/supabase.ts without window export, js/ directory cleared of legacy services.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-remove-legacy-files/17-01-SUMMARY.md

**Prior plan completed:**
- Plan 17-01 removed JS script tags from index.html
- Plan 17-01 removed JS from vite static-copy
- Legacy JS files are no longer loaded or copied

**Files to modify/delete:**
@src/lib/supabase.ts
@js/auth.js
@js/exercises.js
@js/templates.js
@js/logging.js
@js/charts.js
@js/timer.js
@js/supabase.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove window.supabaseClient export from supabase.ts</name>
  <files>src/lib/supabase.ts</files>
  <action>
Remove the backward compatibility code (lines 39-46):
- Remove the comment "Backward compatibility: export to window for legacy JS code"
- Remove the `declare global { interface Window { supabaseClient: SupabaseClient; } }` block
- Remove the `window.supabaseClient = supabase;` assignment

Keep: All Vite environment variable handling and the clean ES module export.
The file should end after `export const supabase: SupabaseClient = ...` line.
  </action>
  <verify>grep -c "window.supabaseClient" src/lib/supabase.ts returns 0 AND npm run build succeeds</verify>
  <done>src/lib/supabase.ts exports only via ES modules, no window global</done>
</task>

<task type="auto">
  <name>Task 2: Delete legacy JS service files</name>
  <files>js/auth.js, js/exercises.js, js/templates.js, js/logging.js, js/charts.js, js/timer.js, js/supabase.js</files>
  <action>
Delete the 7 legacy JavaScript service files that have been replaced by TypeScript:
- js/auth.js (replaced by src/services/auth.ts)
- js/exercises.js (replaced by src/services/exercises.ts)
- js/templates.js (replaced by src/services/templates.ts)
- js/logging.js (replaced by src/services/logging.ts)
- js/charts.js (replaced by src/services/charts.ts)
- js/timer.js (timer functionality now in Preact components)
- js/supabase.js (replaced by src/lib/supabase.ts)

Note: Do NOT delete js/config.local.js if it exists - that's a user-specific local config file.
  </action>
  <verify>ls js/*.js 2>/dev/null shows only config.local.js (or empty) AND npm run build succeeds</verify>
  <done>Legacy JS service files deleted, only config.local.js remains (if it exists)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] No window.supabaseClient in src/lib/supabase.ts
- [ ] js/auth.js, js/exercises.js, js/templates.js, js/logging.js, js/charts.js, js/timer.js, js/supabase.js all deleted
- [ ] `npm run build` succeeds without errors
- [ ] `npm run dev` starts app successfully
- [ ] App functions correctly (login, dashboard, workout, charts all work)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors introduced
- Legacy JS files removed from codebase
- Phase 17 complete - v1.2 Legacy Code Cleanup milestone complete
</success_criteria>

<output>
After completion, create `.planning/phases/17-remove-legacy-files/17-02-SUMMARY.md`

This completes Milestone v1.2 Legacy Code Cleanup:
- Phase 14: Workout Service Imports ✓
- Phase 15: Dashboard Service Imports ✓
- Phase 16: Remove Window Exports ✓
- Phase 17: Remove Legacy Files ✓
</output>
