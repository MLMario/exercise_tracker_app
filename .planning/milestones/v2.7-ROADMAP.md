# Milestone v2.7: Pre-Created Exercise Library

**Status:** SHIPPED 2026-02-02
**Phases:** 8-13
**Total Plans:** 6

## Overview

Add a library of ~800 pre-created exercises from free-exercise-db that users can pick from when adding exercises during template creation or workout logging. Schema changes support system exercises with nullable user_id, RLS policies enable shared read access, and the exercise picker displays both user and system exercises with visual distinction.

## Phases

### Phase 8: Database Schema Migration

**Goal**: Modify exercises table schema and RLS policies to support system exercises
**Depends on**: None
**Plans**: 1 plan

Plans:

- [x] 08-01: Create migration SQL for schema changes, RLS policies, and indexes

**Details:**
- Made user_id nullable to allow system exercises without owner
- Added is_system boolean column with default false
- Added metadata columns: instructions (text[]), level, force, mechanic
- Added 'Other' to category CHECK constraint
- Created partial index on is_system=true for efficient system exercises lookup
- Updated RLS policies: SELECT allows user's own + all system exercises, INSERT/UPDATE/DELETE restricted to user's own non-system exercises
- Used (SELECT auth.uid()) optimization for RLS performance

### Phase 9: Data Import

**Goal**: Fetch and transform exercise data from free-exercise-db, generate CSV for Supabase import
**Depends on**: Phase 8
**Plans**: 1 plan

Plans:

- [x] 09-01: Create TypeScript script to fetch, transform, and generate CSV for Supabase import

**Details:**
- Created tsx-powered import script with fetch, transform, and CSV generation
- Generated 873 exercises mapped to app's 7 categories (Chest, Back, Shoulders, Legs, Arms, Core, Other)
- CSV ready for Supabase Table Editor import with proper PostgreSQL array format
- Category distribution: Legs (298), Arms (149), Shoulders (127), Back (114), Core (93), Chest (84), Other (8)

### Phase 10: Backend Updates

**Goal**: Update TypeScript types and service functions to support system exercises
**Depends on**: Phase 8
**Plans**: 1 plan

Plans:

- [x] 10-01: Update Exercise type and service functions for system exercises

**Details:**
- Extended Exercise interface with is_system, instructions, level, force, mechanic fields (nullable)
- Added 'Other' to ExerciseCategory type
- Updated createExercise to explicitly set is_system=false for user-created exercises

### Phase 11: Frontend Updates

**Goal**: Add visual distinction and sorting to exercise picker
**Depends on**: Phase 10
**Plans**: 1 plan

Plans:

- [x] 11-01: Add CSS styles and update ExercisePickerModal with sorting and badge

**Details:**
- Exercise picker sorts: user exercises first, then system, both alphabetical
- Added green gradient "CUSTOM" badge for user-created exercises
- System exercises displayed with muted text color (#a1a1aa) for visual differentiation
- Category displayed as text below exercise name

### Phase 12: Exercise Picker Layout

**Goal**: Move category text below exercise name in picker for improved visual hierarchy
**Depends on**: Phase 11
**Plans**: 1 plan

Plans:

- [x] 12-01: Update exercise item layout to show category below name

**Details:**
- Changed .exercise-item-info to flex-direction: column with 2px gap
- Added text truncation to .exercise-item-name to prevent long names from breaking layout
- Clean vertical stacking with minimal spacing

### Phase 13: System Exercise Color Fix

**Goal**: Remove graying from system exercises in exercise picker
**Depends on**: Phase 11
**Plans**: 1 plan

Plans:

- [x] 13-01: Remove graying from system exercises in exercise picker

**Details:**
- Removed CSS color override that caused system exercises to display with muted gray text
- All exercises now inherit bright white (#fafafa) color
- Visual differentiation now solely through "Custom" badge on user exercises

---

## Milestone Summary

**Decimal Phases:**
None - phases 8-13 executed in sequence

**Key Decisions:**
- (SELECT auth.uid()) wrapper for RLS performance optimization
- 'Other' category for exercises that don't map cleanly to existing 6 categories
- tsx for zero-config TypeScript script execution
- Option B (Solid Pill) badge design for custom exercises
- Removed color override rather than changing it - simpler solution

**Issues Resolved:**
- RLS policies correctly allow shared read access while protecting write operations
- Text truncation prevents long exercise names from breaking picker layout
- System exercises now display same color as user exercises (visual parity)

**Issues Deferred:**
None

**Technical Debt Incurred:**
- Database migration requires manual execution via Supabase SQL Editor
- CSV import requires manual execution via Supabase Table Editor
- Exercise metadata fields (instructions, level, force, mechanic) stored but not displayed in UI

---

_For current project status, see .planning/ROADMAP.md_
