<!DOCTYPE html>
<html>
<head>
    <title>Swipe Delete Diagnostic</title>
    <style>
        body { font-family: system-ui; padding: 20px; background: #1a1a1a; color: white; }
        .log { background: #0a0a0a; padding: 10px; margin: 10px 0; border-radius: 5px; max-height: 300px; overflow-y: auto; }
        .log div { margin: 2px 0; font-family: monospace; font-size: 12px; }
        .pass { color: #4ade80; }
        .fail { color: #f87171; }
        .info { color: #4f9eff; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        h2 { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>Swipe Delete Diagnostic Tool</h1>

    <h2>Step 1: Check if code is loaded correctly</h2>
    <button onclick="checkCode()">Run Code Check</button>
    <div id="codeLog" class="log"></div>

    <h2>Step 2: Test in the app</h2>
    <p>Instructions:</p>
    <ol>
        <li>Open <a href="index.html?v=diag" target="_blank">the app in a new tab</a></li>
        <li>Login and start a workout</li>
        <li>Open browser DevTools (F12) and go to Console tab</li>
        <li>Paste this code and press Enter:</li>
    </ol>
    <pre style="background: #0a0a0a; padding: 15px; overflow-x: auto;">
// Diagnostic: Add logging to swipe functions
const app = document.querySelector('[x-data]')._x_dataStack[0];

// Wrap removeSetFromExercise
const origRemove = app.removeSetFromExercise.bind(app);
app.removeSetFromExercise = function(exIdx, setIdx) {
    console.log('%c[DELETE] removeSetFromExercise called with:', 'color: orange', {exIdx, setIdx});
    console.log('%c[DELETE] Sets before:', 'color: orange', app.activeWorkout.exercises[exIdx]?.sets?.length);
    origRemove(exIdx, setIdx);
    console.log('%c[DELETE] Sets after:', 'color: lime', app.activeWorkout.exercises[exIdx]?.sets?.length);
};

// Wrap handleSwipeCancel
const origCancel = app.handleSwipeCancel.bind(app);
app.handleSwipeCancel = function() {
    console.log('%c[SWIPE] handleSwipeCancel called', 'color: cyan');
    origCancel();
};

console.log('%c✓ Diagnostic hooks installed! Now try swiping and deleting a set.', 'color: lime; font-size: 14px');
    </pre>

    <h2>Step 3: What to look for</h2>
    <p>When you swipe and tap the delete button, you should see in the console:</p>
    <ol>
        <li><code style="color: cyan">[SWIPE] handleSwipeCancel called</code></li>
        <li><code style="color: orange">[DELETE] removeSetFromExercise called with: {exIdx: 0, setIdx: 0}</code></li>
        <li><code style="color: orange">[DELETE] Sets before: 3</code></li>
        <li><code style="color: lime">[DELETE] Sets after: 2</code></li>
    </ol>
    <p>If you DON'T see these messages, the button click isn't triggering the function.</p>

    <h2>Common Issues:</h2>
    <ul>
        <li><strong>No console messages at all:</strong> The button click isn't being registered (z-index or pointer-events issue)</li>
        <li><strong>Sets before/after are the same:</strong> The delete logic isn't working</li>
        <li><strong>Only handleSwipeCancel shows:</strong> removeSetFromExercise isn't being called</li>
    </ul>

    <script>
        function log(el, msg, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = msg;
            el.appendChild(div);
        }

        function checkCode() {
            const logEl = document.getElementById('codeLog');
            logEl.innerHTML = '';

            // Check app.js
            fetch('js/app.js?t=' + Date.now())
                .then(r => r.text())
                .then(text => {
                    // Check for the fix
                    if (text.includes('Clear transform on ALL')) {
                        log(logEl, '✓ app.js: Has "Clear transform on ALL" fix', 'pass');
                    } else {
                        log(logEl, '✗ app.js: Missing transform clearing fix', 'fail');
                    }

                    // Check handleSwipeCancel clears all rows
                    if (text.includes("document.querySelectorAll('.set-row')")) {
                        log(logEl, '✓ app.js: handleSwipeCancel clears all set-row transforms', 'pass');
                    } else {
                        log(logEl, '✗ app.js: handleSwipeCancel not clearing all transforms', 'fail');
                    }
                });

            // Check index.html
            fetch('index.html?t=' + Date.now())
                .then(r => r.text())
                .then(text => {
                    // Check order of function calls
                    if (text.includes('handleSwipeCancel(); removeSetFromExercise')) {
                        log(logEl, '✓ index.html: Correct order (handleSwipeCancel THEN removeSet)', 'pass');
                    } else if (text.includes('removeSetFromExercise') && text.includes('handleSwipeCancel')) {
                        log(logEl, '✗ index.html: Wrong order (should be handleSwipeCancel first)', 'fail');
                    } else {
                        log(logEl, '? index.html: Could not find delete button handler', 'info');
                    }
                });

            // Check CSS
            fetch('css/styles.css?t=' + Date.now())
                .then(r => r.text())
                .then(text => {
                    if (text.includes('@media (hover: hover) and (pointer: fine)')) {
                        log(logEl, '✓ styles.css: Has hover media query for desktop-only hover', 'pass');
                    } else {
                        log(logEl, '✗ styles.css: Missing hover media query', 'fail');
                    }

                    if (text.includes('z-index: 3')) {
                        log(logEl, '✓ styles.css: Delete button has z-index: 3 when revealed', 'pass');
                    } else {
                        log(logEl, '? styles.css: Check if delete button z-index is set when revealed', 'info');
                    }
                });
        }
    </script>
</body>
</html>
