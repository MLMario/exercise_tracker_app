---
phase: 01-foundation
plan: 02
type: execute
depends_on: ["01-01"]
files_modified: [src/main.ts, src/env.d.ts, index.html, .env.example, .gitignore]
---

<objective>
Create source entry point and integrate Vite into existing app.

Purpose: Establish the src/ structure and verify the build pipeline works with the existing app.
Output: Working Vite dev server, successful production build, existing app still functional.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@index.html
@js/supabase.js

**From Plan 01:**
- package.json with Vite and TypeScript
- vite.config.ts configured
- tsconfig.json ready

**Key constraints:**
- Existing CDN scripts must continue working (Alpine, Supabase from CDN)
- Vite entry runs alongside existing code during migration
- Environment variables replace window globals pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create src/ entry point and environment types</name>
  <files>src/main.ts, src/env.d.ts</files>
  <action>
Create src/main.ts with:
- Console log: "Vite + TypeScript initialized" (proves Vite is working)
- Comment: "// Future: Import and initialize app modules here"
- Keep it minimal - this is a placeholder for Phase 2+ work

Create src/env.d.ts with:
- Triple-slash reference to vite/client types
- Interface ImportMetaEnv with VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY (both string)
- Interface ImportMeta extending env

Create .env.example with:
- VITE_SUPABASE_URL=your-supabase-url
- VITE_SUPABASE_ANON_KEY=your-anon-key

Update .gitignore:
- Add .env and .env.local if not already present
- Ensure node_modules and dist are ignored
  </action>
  <verify>
- src/main.ts exists
- src/env.d.ts exists
- .env.example exists
- TypeScript recognizes import.meta.env (no red squiggles in IDE)
  </verify>
  <done>src/ structure created with proper TypeScript environment support</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Vite module into index.html</name>
  <files>index.html</files>
  <action>
Modify index.html to add Vite's module entry BEFORE the closing </body> tag:

Add: <script type="module" src="/src/main.ts"></script>

Place this AFTER all existing CDN scripts so:
1. CDN libs (Supabase, Alpine, Chart.js) load first
2. Existing js/*.js scripts load and work as before
3. Vite entry loads last (won't interfere with existing code)

Do NOT remove or modify any existing script tags.
The goal is coexistence during migration.
  </action>
  <verify>View source of index.html shows new module script tag at the end</verify>
  <done>index.html includes Vite module entry without breaking existing scripts</done>
</task>

<task type="auto">
  <name>Task 3: Verify build pipeline</name>
  <files>-</files>
  <action>
Run and verify:

1. Dev server: npm run dev
   - Should open browser
   - Console should show "Vite + TypeScript initialized"
   - Existing app should still work (login form visible, etc.)

2. Production build: npm run build
   - Should complete without errors
   - dist/ folder should be created
   - dist/ should contain index.html and assets

3. Preview build: npm run preview
   - Should serve the production build
   - Same behavior as dev server

If any step fails, diagnose and fix before proceeding.
  </action>
  <verify>
- npm run dev opens working app with console message
- npm run build creates dist/ folder
- npm run preview serves the built app
  </verify>
  <done>Full Vite pipeline working: dev, build, preview all succeed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/main.ts exists and logs message
- [ ] src/env.d.ts provides environment types
- [ ] index.html includes Vite module script
- [ ] `npm run dev` works (console shows message)
- [ ] `npm run build` succeeds (dist/ created)
- [ ] Existing app still works (CDN scripts unaffected)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Vite dev server runs the app
- Production build completes
- Existing functionality preserved (app works same as before)
- Phase 1: Foundation complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
