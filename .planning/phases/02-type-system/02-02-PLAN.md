---
phase: 02-type-system
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [src/types/services.ts, src/types/index.ts]
---

<objective>
Create TypeScript interfaces for all service modules (auth, exercises, templates, logging).

Purpose: Define the contracts for service modules that will be migrated in later phases, enabling type-safe refactoring.
Output: `src/types/services.ts` with interfaces matching the existing window.* service APIs.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./02-02-summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-type-system/02-01-SUMMARY.md

**Tech stack available:** Vite 7.3.1, TypeScript 5.9.3, @supabase/supabase-js 2.90.1
**Established patterns:** ESM modules, strict TypeScript, bundler moduleResolution
**Available types:** Database types from Plan 01 (Exercise, Template, WorkoutLog, etc.)

**Service modules to type (from js/*.js):**
- `window.auth` - register, login, logout, resetPassword, updateUser, getCurrentUser, getSession, onAuthStateChange
- `window.exercises` - getExercises, getExercisesByCategory, createExercise, deleteExercise, exerciseExists, getCategories
- `window.templates` - getTemplates, getTemplate, createTemplate, updateTemplate, deleteTemplate, addExerciseToTemplate, removeExerciseFromTemplate, updateTemplateExercise
- `window.logging` - createWorkoutLog, getWorkoutLogs, getWorkoutLog, getExerciseHistory, getExerciseMetrics, getRecentExerciseData

**Source files for reference:**
@js/auth.js
@js/exercises.js
@js/templates.js
@js/logging.js
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create service type definitions</name>
  <files>src/types/services.ts</files>
  <action>
Create TypeScript interfaces for all service modules. Import database types where needed.

1. **Result types** (standard return patterns):
   - `ServiceResult<T>` - { data: T | null; error: Error | null }
   - `ServiceError` - { error: Error | null }
   - `AuthResult` - { user: User | null; error: Error | null }
   - `SuccessResult` - { success: boolean; error: Error | null }

2. **Supabase auth types** (import from @supabase/supabase-js):
   - Use `User`, `Session`, `AuthChangeEvent` from Supabase types
   - `AuthSubscription` for onAuthStateChange return

3. **AuthService interface:**
   ```typescript
   interface AuthService {
     register(email: string, password: string): Promise<AuthResult>;
     login(email: string, password: string): Promise<AuthResult>;
     logout(): Promise<ServiceError>;
     resetPassword(email: string): Promise<SuccessResult>;
     updateUser(password: string): Promise<SuccessResult>;
     getCurrentUser(): Promise<User | null>;
     getSession(): Promise<Session | null>;
     onAuthStateChange(callback: (event: AuthChangeEvent, session: Session | null) => void): AuthSubscription | null;
   }
   ```

4. **ExercisesService interface:**
   - getExercises(): Promise<ServiceResult<Exercise[]>>
   - getExercisesByCategory(category: ExerciseCategory): Promise<ServiceResult<Exercise[]>>
   - createExercise(name: string, category: ExerciseCategory, equipment?: string | null): Promise<ServiceResult<Exercise>>
   - deleteExercise(id: string): Promise<ServiceError>
   - exerciseExists(name: string): Promise<boolean>
   - getCategories(): ExerciseCategory[]

5. **TemplatesService interface:**
   - getTemplates(): Promise<ServiceResult<TemplateWithExercises[]>>
   - getTemplate(id: string): Promise<ServiceResult<TemplateWithExercises>>
   - createTemplate(name: string, exercises?: TemplateExerciseInput[]): Promise<ServiceResult<Template>>
   - updateTemplate(id: string, name: string, exercises?: TemplateExerciseInput[]): Promise<ServiceResult<Template>>
   - deleteTemplate(id: string): Promise<ServiceError>
   - addExerciseToTemplate(templateId: string, exercise: TemplateExerciseInput): Promise<ServiceResult<TemplateExercise>>
   - removeExerciseFromTemplate(templateId: string, exerciseId: string): Promise<ServiceError>
   - updateTemplateExercise(templateId: string, exerciseId: string, defaults: TemplateExerciseDefaults): Promise<ServiceResult<TemplateExercise>>

6. **LoggingService interface:**
   - createWorkoutLog(data: WorkoutLogInput): Promise<ServiceResult<WorkoutLog>>
   - getWorkoutLogs(limit?: number): Promise<ServiceResult<WorkoutLogSummary[]>>
   - getWorkoutLog(id: string): Promise<ServiceResult<WorkoutLogWithExercises>>
   - getExerciseHistory(exerciseId: string, options?: ExerciseHistoryOptions): Promise<ServiceResult<ExerciseHistoryData[]>>
   - getExerciseMetrics(exerciseId: string, options?: ExerciseMetricsOptions): Promise<ServiceResult<ChartData>>
   - getRecentExerciseData(exerciseId: string): Promise<RecentExerciseData | null>

7. **Input/Options types:**
   - `TemplateExerciseInput` - exercise_id, default_rest_seconds?, sets?
   - `TemplateExerciseDefaults` - default_rest_seconds
   - `WorkoutLogInput` - template_id?, started_at, exercises
   - `ExerciseHistoryOptions` - mode, limit
   - `ExerciseMetricsOptions` - metric, mode, limit
   - `ChartData` - { labels: string[]; values: number[] }
   - `RecentExerciseData` - { sets, reps, weight, rest_seconds }

Use JSDoc comments. Export all types.
  </action>
  <verify>npx tsc --noEmit passes without errors</verify>
  <done>src/types/services.ts exists with all service interfaces and supporting types. TypeScript compilation succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Update types barrel export</name>
  <files>src/types/index.ts</files>
  <action>
Update the barrel export to include service types:

```typescript
export * from './database';
export * from './services';
```
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>src/types/index.ts re-exports both database and service types</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes without errors
- [ ] src/types/services.ts contains ServiceResult, ServiceError, AuthResult, SuccessResult
- [ ] src/types/services.ts contains AuthService interface matching js/auth.js API
- [ ] src/types/services.ts contains ExercisesService interface matching js/exercises.js API
- [ ] src/types/services.ts contains TemplatesService interface matching js/templates.js API
- [ ] src/types/services.ts contains LoggingService interface matching js/logging.js API
- [ ] src/types/services.ts contains all input/options types
- [ ] src/types/index.ts re-exports service types
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Service interfaces match existing window.* module APIs exactly
- Phase 2: Type System complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-system/02-02-SUMMARY.md`
</output>
