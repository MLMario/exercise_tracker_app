---
phase: 28-config-updates
plan: 01
type: execute
depends_on: []
files_modified: [tsconfig.json, packages/shared/tsconfig.json, packages/shared/src/lib/supabase.ts, apps/web/tsconfig.json, vercel.json]
---

<objective>
Update TypeScript project references and Vercel config for monorepo paths.

Purpose: Fix TypeScript compilation with proper composite project setup and configure Vercel deployment for monorepo structure.
Output: Working `tsc --build` at root, Vercel deploy config pointing to apps/web.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/27-update-imports/27-01-SUMMARY.md

**Current Structure:**
```
ironlift/
├── packages/shared/     # @ironlift/shared - types, services, lib
├── apps/web/           # @ironlift/web - Preact web app
├── tsconfig.json       # Root config with project references
├── pnpm-workspace.yaml
└── vercel.json         # Deployment config
```

**Current Issues:**
1. Root `tsc --noEmit` fails with TS6305 errors (project references misconfigured)
2. `packages/shared/src/lib/supabase.ts` has `/// <reference types="vite/client" />` but shared package has no vite dependency
3. `vercel.json` points to root `dist` instead of `apps/web/dist`

**Vite config already correct:**
- apps/web/vite.config.ts has proper workspace resolution (preserveSymlinks, optimizeDeps)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix TypeScript project references configuration</name>
  <files>tsconfig.json, packages/shared/tsconfig.json, apps/web/tsconfig.json</files>
  <action>
Configure TypeScript composite projects properly:

**Root tsconfig.json:**
- Remove references array (we use solution-style with workspace:* deps, not build-mode references)
- Keep noEmit: true (Vite handles builds, TS is for type checking only)
- Remove include/exclude (root only provides base config)

**packages/shared/tsconfig.json:**
- Add composite: true for project references
- Keep noEmit: true (source imports, no declaration files)
- Keep existing extends, include, exclude

**apps/web/tsconfig.json:**
- Add composite: true for project references
- Keep noEmit: true (Vite handles builds)
- Keep existing paths, include, exclude

The key insight: with source imports (`"main": "src/index.ts"`), we don't need declaration files or tsc --build. We just need each package to type-check independently.
  </action>
  <verify>
Run `pnpm exec tsc --noEmit` from root - should pass
Run `pnpm exec tsc --noEmit` from apps/web - should pass
Run `pnpm exec tsc --noEmit` from packages/shared - should pass (after Task 2 fixes vite/client)
  </verify>
  <done>All three locations pass tsc --noEmit with no errors</done>
</task>

<task type="auto">
  <name>Task 2: Fix vite/client types in shared package</name>
  <files>packages/shared/src/lib/supabase.ts</files>
  <action>
The shared package references `/// <reference types="vite/client" />` for `import.meta.env` but has no vite dependency. Two options:

Option A (recommended): Declare the types inline in shared package
- Remove the triple-slash reference
- Add ambient type declaration for import.meta.env in shared package

Option B: Add vite as devDependency to shared package
- Adds unnecessary dependency to shared package

Implement Option A:
1. Remove `/// <reference types="vite/client" />` from supabase.ts
2. Create `packages/shared/src/env.d.ts` with ImportMetaEnv declaration
3. Add env.d.ts to tsconfig include

This keeps shared package framework-agnostic while providing proper types.
  </action>
  <verify>Run `cd packages/shared && pnpm exec tsc --noEmit` - should pass with no vite/client error</verify>
  <done>Shared package type-checks independently without vite dependency</done>
</task>

<task type="auto">
  <name>Task 3: Update vercel.json for monorepo deployment</name>
  <files>vercel.json</files>
  <action>
Update vercel.json to build and deploy the web app from apps/web/:

```json
{
  "buildCommand": "pnpm --filter @ironlift/web build",
  "outputDirectory": "apps/web/dist",
  "installCommand": "pnpm install",
  "framework": "vite"
}
```

Key changes:
- buildCommand: Use pnpm filter to build only web app
- outputDirectory: Point to apps/web/dist where Vite outputs
- installCommand: Use pnpm (not npm) for workspace deps
  </action>
  <verify>Run `pnpm --filter @ironlift/web build` - should succeed and create apps/web/dist/</verify>
  <done>vercel.json configured for monorepo deployment, build outputs to apps/web/dist</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm exec tsc --noEmit` from root passes
- [ ] `pnpm exec tsc --noEmit` from packages/shared passes
- [ ] `pnpm exec tsc --noEmit` from apps/web passes
- [ ] `pnpm run build` succeeds (via root script)
- [ ] `apps/web/dist/` contains built files
</verification>

<success_criteria>

- All TypeScript type-checking passes at all levels
- Shared package type-checks without vite dependency
- Vite build succeeds
- vercel.json properly configured for monorepo
- Phase 28 complete
</success_criteria>

<output>
After completion, create `.planning/phases/28-config-updates/28-01-SUMMARY.md`
</output>
